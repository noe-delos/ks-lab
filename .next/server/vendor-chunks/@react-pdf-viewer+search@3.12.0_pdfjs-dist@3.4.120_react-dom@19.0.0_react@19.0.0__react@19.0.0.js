"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0";
exports.ids = ["vendor-chunks/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0"];
exports.modules = {

/***/ "(ssr)/./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/cjs/search.js":
/*!***********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/cjs/search.js ***!
  \***********************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\n\nvar core = __webpack_require__(/*! @react-pdf-viewer/core */ \"(ssr)/./node_modules/.pnpm/@react-pdf-viewer+core@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/core/lib/index.js\");\nvar React = __webpack_require__(/*! react */ \"(ssr)/./node_modules/.pnpm/next@15.1.3_@babel+core@7.26.0_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/next/dist/server/route-modules/app-page/vendored/ssr/react.js\");\n\nfunction _interopNamespaceDefault(e) {\n    var n = Object.create(null);\n    if (e) {\n        Object.keys(e).forEach(function (k) {\n            if (k !== 'default') {\n                var d = Object.getOwnPropertyDescriptor(e, k);\n                Object.defineProperty(n, k, d.get ? d : {\n                    enumerable: true,\n                    get: function () { return e[k]; }\n                });\n            }\n        });\n    }\n    n.default = e;\n    return Object.freeze(n);\n}\n\nvar React__namespace = /*#__PURE__*/_interopNamespaceDefault(React);\n\nvar NextIcon = function () { return (React__namespace.createElement(core.Icon, { size: 16 },\n    React__namespace.createElement(\"path\", { d: \"M0.541,5.627L11.666,18.2c0.183,0.207,0.499,0.226,0.706,0.043c0.015-0.014,0.03-0.028,0.043-0.043\\n            L23.541,5.627\" }))); };\n\nvar PreviousIcon = function () { return (React__namespace.createElement(core.Icon, { size: 16 },\n    React__namespace.createElement(\"path\", { d: \"M23.535,18.373L12.409,5.8c-0.183-0.207-0.499-0.226-0.706-0.043C11.688,5.77,11.674,5.785,11.66,5.8\\n            L0.535,18.373\" }))); };\n\nvar SearchIcon = function () { return (React__namespace.createElement(core.Icon, { ignoreDirection: true, size: 16 },\n    React__namespace.createElement(\"path\", { d: \"M10.5,0.5c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.5,10.5,0.5z\\n            M23.5,23.5\\n            l-5.929-5.929\" }))); };\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\n\nvar EMPTY_KEYWORD_REGEXP = {\n    keyword: '',\n    regExp: new RegExp(' '),\n    wholeWords: false,\n};\n\nvar calculateOffset = function (children, parent) {\n    var top = children.offsetTop;\n    var left = children.offsetLeft;\n    var p = children.parentElement;\n    while (p && p !== parent) {\n        top += p.offsetTop;\n        left += p.offsetLeft;\n        p = p.parentElement;\n    }\n    return {\n        left: left,\n        top: top,\n    };\n};\n\nvar getCssProperties = function (area) {\n    return {\n        left: \"\".concat(area.left, \"%\"),\n        top: \"\".concat(area.top, \"%\"),\n        height: \"\".concat(area.height, \"%\"),\n        width: \"\".concat(area.width, \"%\"),\n    };\n};\n\nvar HightlightItem = function (_a) {\n    var index = _a.index, area = _a.area, onHighlightKeyword = _a.onHighlightKeyword;\n    var containerRef = React__namespace.useRef();\n    core.useIsomorphicLayoutEffect(function () {\n        var highlightEle = containerRef.current;\n        if (onHighlightKeyword && highlightEle) {\n            onHighlightKeyword({\n                highlightEle: highlightEle,\n                keyword: area.keyword,\n            });\n        }\n    }, []);\n    return (React__namespace.createElement(\"div\", { className: \"rpv-search__highlight\", \"data-index\": index, ref: containerRef, style: getCssProperties(area), title: area.keywordStr.trim() }));\n};\n\nvar removeNode = function (ele) {\n    var parent = ele.parentNode;\n    if (parent) {\n        parent.removeChild(ele);\n    }\n};\nvar replaceNode = function (replacementNode, node) {\n    removeNode(replacementNode);\n    var parent = node.parentNode;\n    if (parent) {\n        parent.insertBefore(replacementNode, node);\n    }\n    removeNode(node);\n};\nvar unwrap = function (ele) {\n    var parent = ele.parentNode;\n    if (!parent) {\n        return;\n    }\n    var range = document.createRange();\n    range.selectNodeContents(ele);\n    replaceNode(range.extractContents(), ele);\n    parent.normalize();\n};\n\nvar sortHighlightPosition = function (a, b) {\n    if (a.top < b.top) {\n        return -1;\n    }\n    if (a.top > b.top) {\n        return 1;\n    }\n    if (a.left < b.left) {\n        return -1;\n    }\n    if (a.left > b.left) {\n        return 1;\n    }\n    return 0;\n};\nvar Highlights = function (_a) {\n    var numPages = _a.numPages, pageIndex = _a.pageIndex, renderHighlights = _a.renderHighlights, store = _a.store, onHighlightKeyword = _a.onHighlightKeyword;\n    var containerRef = React__namespace.useRef();\n    var defaultRenderHighlights = React__namespace.useCallback(function (renderProps) { return (React__namespace.createElement(React__namespace.Fragment, null, renderProps.highlightAreas.map(function (area, index) { return (React__namespace.createElement(HightlightItem, { index: index, key: index, area: area, onHighlightKeyword: onHighlightKeyword })); }))); }, []);\n    var renderHighlightElements = renderHighlights || defaultRenderHighlights;\n    var _b = React__namespace.useState(store.get('matchPosition')), matchPosition = _b[0], setMatchPosition = _b[1];\n    var _c = React__namespace.useState(store.get('keyword') || [EMPTY_KEYWORD_REGEXP]), keywordRegexp = _c[0], setKeywordRegexp = _c[1];\n    var _d = React__namespace.useState({\n        pageIndex: pageIndex,\n        scale: 1,\n        status: core.LayerRenderStatus.PreRender,\n    }), renderStatus = _d[0], setRenderStatus = _d[1];\n    var currentMatchRef = React__namespace.useRef(null);\n    var characterIndexesRef = React__namespace.useRef([]);\n    var _e = React__namespace.useState([]), highlightAreas = _e[0], setHighlightAreas = _e[1];\n    var defaultTargetPageFilter = function () { return true; };\n    var targetPageFilter = React__namespace.useCallback(function () { return store.get('targetPageFilter') || defaultTargetPageFilter; }, [store.get('targetPageFilter')]);\n    var highlight = function (keywordStr, keyword, textLayerEle, span, charIndexSpan) {\n        var range = document.createRange();\n        var firstChild = span.firstChild;\n        if (!firstChild || firstChild.nodeType !== Node.TEXT_NODE) {\n            return null;\n        }\n        var length = firstChild.textContent.length;\n        var startOffset = charIndexSpan[0].charIndexInSpan;\n        var endOffset = charIndexSpan.length === 1 ? startOffset : charIndexSpan[charIndexSpan.length - 1].charIndexInSpan;\n        if (startOffset > length || endOffset + 1 > length) {\n            return null;\n        }\n        range.setStart(firstChild, startOffset);\n        range.setEnd(firstChild, endOffset + 1);\n        var wrapper = document.createElement('span');\n        range.surroundContents(wrapper);\n        var wrapperRect = wrapper.getBoundingClientRect();\n        var textLayerRect = textLayerEle.getBoundingClientRect();\n        var pageHeight = textLayerRect.height;\n        var pageWidth = textLayerRect.width;\n        var left = (100 * (wrapperRect.left - textLayerRect.left)) / pageWidth;\n        var top = (100 * (wrapperRect.top - textLayerRect.top)) / pageHeight;\n        var height = (100 * wrapperRect.height) / pageHeight;\n        var width = (100 * wrapperRect.width) / pageWidth;\n        unwrap(wrapper);\n        return {\n            keyword: keyword,\n            keywordStr: keywordStr,\n            numPages: numPages,\n            pageIndex: pageIndex,\n            left: left,\n            top: top,\n            height: height,\n            width: width,\n            pageHeight: pageHeight,\n            pageWidth: pageWidth,\n        };\n    };\n    var highlightAll = function (textLayerEle) {\n        var charIndexes = characterIndexesRef.current;\n        if (charIndexes.length === 0) {\n            return [];\n        }\n        var highlightPos = [];\n        var spans = [].slice.call(textLayerEle.querySelectorAll('.rpv-core__text-layer-text'));\n        var fullText = charIndexes.map(function (item) { return item.char; }).join('');\n        keywordRegexp.forEach(function (keyword) {\n            var keywordStr = keyword.keyword;\n            if (!keywordStr.trim()) {\n                return;\n            }\n            var cloneKeyword = keyword.regExp.flags.indexOf('g') === -1\n                ? new RegExp(keyword.regExp, \"\".concat(keyword.regExp.flags, \"g\"))\n                : keyword.regExp;\n            var match;\n            var matches = [];\n            while ((match = cloneKeyword.exec(fullText)) !== null) {\n                matches.push({\n                    keyword: cloneKeyword,\n                    startIndex: match.index,\n                    endIndex: cloneKeyword.lastIndex,\n                });\n            }\n            matches\n                .map(function (item) { return ({\n                keyword: item.keyword,\n                indexes: charIndexes.slice(item.startIndex, item.endIndex),\n            }); })\n                .forEach(function (item) {\n                var spanIndexes = item.indexes.reduce(function (acc, item) {\n                    acc[item.spanIndex] = (acc[item.spanIndex] || []).concat([item]);\n                    return acc;\n                }, {});\n                Object.values(spanIndexes).forEach(function (charIndexSpan) {\n                    if (charIndexSpan.length !== 1 || charIndexSpan[0].char.trim() !== '') {\n                        var normalizedCharSpan = keyword.wholeWords ? charIndexSpan.slice(1, -1) : charIndexSpan;\n                        var hightlighPosition = highlight(keywordStr, item.keyword, textLayerEle, spans[normalizedCharSpan[0].spanIndex], normalizedCharSpan);\n                        if (hightlighPosition) {\n                            highlightPos.push(hightlighPosition);\n                        }\n                    }\n                });\n            });\n        });\n        return highlightPos.sort(sortHighlightPosition);\n    };\n    var handleKeywordChanged = function (keyword) {\n        if (keyword && keyword.length > 0) {\n            setKeywordRegexp(keyword);\n        }\n    };\n    var handleMatchPositionChanged = function (currentPosition) { return setMatchPosition(currentPosition); };\n    var handleRenderStatusChanged = function (status) {\n        if (!status.has(pageIndex)) {\n            return;\n        }\n        var currentStatus = status.get(pageIndex);\n        if (currentStatus) {\n            setRenderStatus({\n                ele: currentStatus.ele,\n                pageIndex: pageIndex,\n                scale: currentStatus.scale,\n                status: currentStatus.status,\n            });\n        }\n    };\n    var isEmptyKeyword = function () {\n        return keywordRegexp.length === 0 || (keywordRegexp.length === 1 && keywordRegexp[0].keyword.trim() === '');\n    };\n    React__namespace.useEffect(function () {\n        if (isEmptyKeyword() ||\n            renderStatus.status !== core.LayerRenderStatus.DidRender ||\n            characterIndexesRef.current.length) {\n            return;\n        }\n        var textLayerEle = renderStatus.ele;\n        var spans = [].slice.call(textLayerEle.querySelectorAll('.rpv-core__text-layer-text'));\n        var charIndexes = spans\n            .map(function (span) { return span.textContent; })\n            .reduce(function (prev, curr, index) {\n            return prev.concat(curr.split('').map(function (c, i) { return ({\n                char: c,\n                charIndexInSpan: i,\n                spanIndex: index,\n            }); }));\n        }, [\n            {\n                char: '',\n                charIndexInSpan: 0,\n                spanIndex: 0,\n            },\n        ])\n            .slice(1);\n        characterIndexesRef.current = charIndexes;\n    }, [keywordRegexp, renderStatus.status]);\n    React__namespace.useEffect(function () {\n        if (isEmptyKeyword() ||\n            !renderStatus.ele ||\n            renderStatus.status !== core.LayerRenderStatus.DidRender ||\n            !targetPageFilter()({ pageIndex: pageIndex, numPages: numPages })) {\n            return;\n        }\n        var textLayerEle = renderStatus.ele;\n        var highlightPos = highlightAll(textLayerEle);\n        setHighlightAreas(highlightPos);\n    }, [keywordRegexp, matchPosition, renderStatus.status, characterIndexesRef.current]);\n    React__namespace.useEffect(function () {\n        if (isEmptyKeyword() && renderStatus.ele && renderStatus.status === core.LayerRenderStatus.DidRender) {\n            setHighlightAreas([]);\n        }\n    }, [keywordRegexp, renderStatus.status]);\n    React__namespace.useEffect(function () {\n        if (highlightAreas.length === 0) {\n            return;\n        }\n        var container = containerRef.current;\n        if (matchPosition.pageIndex !== pageIndex ||\n            !container ||\n            renderStatus.status !== core.LayerRenderStatus.DidRender) {\n            return;\n        }\n        var highlightEle = container.querySelector(\".rpv-search__highlight[data-index=\\\"\".concat(matchPosition.matchIndex, \"\\\"]\"));\n        if (!highlightEle) {\n            return;\n        }\n        var _a = calculateOffset(highlightEle, container), left = _a.left, top = _a.top;\n        var jump = store.get('jumpToDestination');\n        if (jump) {\n            jump({\n                pageIndex: pageIndex,\n                bottomOffset: (container.getBoundingClientRect().height - top) / renderStatus.scale,\n                leftOffset: left / renderStatus.scale,\n                scaleTo: renderStatus.scale,\n            });\n            if (currentMatchRef.current) {\n                currentMatchRef.current.classList.remove('rpv-search__highlight--current');\n            }\n            currentMatchRef.current = highlightEle;\n            highlightEle.classList.add('rpv-search__highlight--current');\n        }\n    }, [highlightAreas, matchPosition]);\n    React__namespace.useEffect(function () {\n        store.subscribe('keyword', handleKeywordChanged);\n        store.subscribe('matchPosition', handleMatchPositionChanged);\n        store.subscribe('renderStatus', handleRenderStatusChanged);\n        return function () {\n            store.unsubscribe('keyword', handleKeywordChanged);\n            store.unsubscribe('matchPosition', handleMatchPositionChanged);\n            store.unsubscribe('renderStatus', handleRenderStatusChanged);\n        };\n    }, []);\n    return (React__namespace.createElement(\"div\", { className: \"rpv-search__highlights\", \"data-testid\": \"search__highlights-\".concat(pageIndex), ref: containerRef }, renderHighlightElements({\n        getCssProperties: getCssProperties,\n        highlightAreas: highlightAreas,\n    })));\n};\n\nvar escapeRegExp = function (input) { return input.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); };\nvar normalizeFlagKeyword = function (flagKeyword) {\n    var source = flagKeyword.wholeWords ? \" \".concat(flagKeyword.keyword, \" \") : flagKeyword.keyword;\n    var flags = flagKeyword.matchCase ? 'g' : 'gi';\n    return {\n        keyword: flagKeyword.keyword,\n        regExp: new RegExp(escapeRegExp(source), flags),\n        wholeWords: flagKeyword.wholeWords || false,\n    };\n};\nvar normalizeSingleKeyword = function (keyword, matchCase, wholeWords) {\n    if (keyword instanceof RegExp) {\n        return {\n            keyword: keyword.source,\n            regExp: keyword,\n            wholeWords: wholeWords || false,\n        };\n    }\n    if (typeof keyword === 'string') {\n        return keyword === ''\n            ? EMPTY_KEYWORD_REGEXP\n            : normalizeFlagKeyword({\n                keyword: keyword,\n                matchCase: matchCase || false,\n                wholeWords: wholeWords || false,\n            });\n    }\n    if (typeof matchCase !== 'undefined') {\n        keyword.matchCase = matchCase;\n    }\n    if (typeof wholeWords !== 'undefined') {\n        keyword.wholeWords = wholeWords;\n    }\n    return normalizeFlagKeyword(keyword);\n};\n\nvar useDocument = function (store) {\n    var currentDocRef = React__namespace.useRef(store.get('doc'));\n    var handleDocumentChanged = function (doc) {\n        currentDocRef.current = doc;\n    };\n    React__namespace.useEffect(function () {\n        store.subscribe('doc', handleDocumentChanged);\n        return function () {\n            store.unsubscribe('doc', handleDocumentChanged);\n        };\n    }, []);\n    return currentDocRef;\n};\n\nvar useSearch = function (store) {\n    var initialKeyword = store.get('initialKeyword');\n    var normalizedKeywordFlags = React__namespace.useMemo(function () {\n        if (initialKeyword && initialKeyword.length === 1) {\n            var normalizedKeyword = normalizeSingleKeyword(initialKeyword[0]);\n            return {\n                matchCase: normalizedKeyword.regExp.flags.indexOf('i') === -1,\n                wholeWords: normalizedKeyword.wholeWords,\n            };\n        }\n        else {\n            return {\n                matchCase: false,\n                wholeWords: false,\n            };\n        }\n    }, []);\n    var currentDocRef = useDocument(store);\n    var _a = React__namespace.useState(initialKeyword), keywords = _a[0], setKeywords = _a[1];\n    var _b = React__namespace.useState([]), found = _b[0], setFound = _b[1];\n    var _c = React__namespace.useState(0), currentMatch = _c[0], setCurrentMatch = _c[1];\n    var _d = React__namespace.useState(normalizedKeywordFlags.matchCase), matchCase = _d[0], setMatchCase = _d[1];\n    var textContents = React__namespace.useRef([]);\n    var _e = React__namespace.useState(normalizedKeywordFlags.wholeWords), wholeWords = _e[0], setWholeWords = _e[1];\n    var defaultTargetPageFilter = function () { return true; };\n    var targetPageFilter = React__namespace.useCallback(function () { return store.get('targetPageFilter') || defaultTargetPageFilter; }, [store.get('targetPageFilter')]);\n    var changeMatchCase = function (isChecked) {\n        setMatchCase(isChecked);\n        if (keywords.length > 0) {\n            searchFor(keywords, isChecked, wholeWords);\n        }\n    };\n    var changeWholeWords = function (isChecked) {\n        setWholeWords(isChecked);\n        if (keywords.length > 0) {\n            searchFor(keywords, matchCase, isChecked);\n        }\n    };\n    var jumpToMatch = function (index) {\n        var numMatches = found.length;\n        if (keywords.length === 0 || numMatches === 0) {\n            return null;\n        }\n        var normalizedIndex = index === numMatches + 1 ? 1 : Math.max(1, Math.min(numMatches, index));\n        setCurrentMatch(normalizedIndex);\n        return jumpToGivenMatch(found[normalizedIndex - 1]);\n    };\n    var jumpToPreviousMatch = function () { return jumpToMatch(currentMatch - 1); };\n    var jumpToNextMatch = function () { return jumpToMatch(currentMatch + 1); };\n    var clearKeyword = function () {\n        store.update('keyword', [EMPTY_KEYWORD_REGEXP]);\n        setKeyword('');\n        setCurrentMatch(0);\n        setFound([]);\n        setMatchCase(false);\n        setWholeWords(false);\n    };\n    var search = function () { return searchFor(keywords, matchCase, wholeWords); };\n    var setKeyword = function (keyword) { return setKeywords(keyword === '' ? [] : [keyword]); };\n    var setTargetPages = function (targetPageFilter) {\n        store.update('targetPageFilter', targetPageFilter);\n    };\n    var getTextContents = function () {\n        var currentDoc = currentDocRef.current;\n        if (!currentDoc) {\n            return Promise.resolve([]);\n        }\n        var promises = Array(currentDoc.numPages)\n            .fill(0)\n            .map(function (_, pageIndex) {\n            return core.getPage(currentDoc, pageIndex)\n                .then(function (page) {\n                return page.getTextContent();\n            })\n                .then(function (content) {\n                var pageContent = content.items.map(function (item) { return item.str || ''; }).join('');\n                return Promise.resolve({\n                    pageContent: pageContent,\n                    pageIndex: pageIndex,\n                });\n            });\n        });\n        return Promise.all(promises).then(function (data) {\n            data.sort(function (a, b) { return a.pageIndex - b.pageIndex; });\n            return Promise.resolve(data.map(function (item) { return item.pageContent; }));\n        });\n    };\n    var jumpToGivenMatch = function (match) {\n        var jumpToPage = store.get('jumpToPage');\n        if (jumpToPage) {\n            jumpToPage(match.pageIndex);\n        }\n        store.update('matchPosition', {\n            matchIndex: match.matchIndex,\n            pageIndex: match.pageIndex,\n        });\n        return match;\n    };\n    var getKeywordSource = function (keyword) {\n        if (keyword instanceof RegExp) {\n            return keyword.source;\n        }\n        if (typeof keyword === 'string') {\n            return keyword;\n        }\n        return keyword.keyword;\n    };\n    var searchFor = function (keywordParam, matchCaseParam, wholeWordsParam) {\n        var currentDoc = currentDocRef.current;\n        if (!currentDoc) {\n            return Promise.resolve([]);\n        }\n        var numPages = currentDoc.numPages;\n        var keywords = keywordParam.map(function (k) { return normalizeSingleKeyword(k, matchCaseParam, wholeWordsParam); });\n        store.update('keyword', keywords);\n        setCurrentMatch(0);\n        setFound([]);\n        return new Promise(function (resolve, _) {\n            var getTextPromise = textContents.current.length === 0\n                ? getTextContents().then(function (response) {\n                    textContents.current = response;\n                    return Promise.resolve(response);\n                })\n                : Promise.resolve(textContents.current);\n            getTextPromise.then(function (response) {\n                var arr = [];\n                response.forEach(function (pageText, pageIndex) {\n                    if (targetPageFilter()({ pageIndex: pageIndex, numPages: numPages })) {\n                        keywords.forEach(function (keyword) {\n                            var matchIndex = 0;\n                            var matches;\n                            while ((matches = keyword.regExp.exec(pageText)) !== null) {\n                                arr.push({\n                                    keyword: keyword.regExp,\n                                    matchIndex: matchIndex,\n                                    pageIndex: pageIndex,\n                                    pageText: pageText,\n                                    startIndex: matches.index,\n                                    endIndex: keyword.regExp.lastIndex,\n                                });\n                                matchIndex++;\n                            }\n                        });\n                    }\n                });\n                setFound(arr);\n                if (arr.length > 0) {\n                    setCurrentMatch(1);\n                    jumpToGivenMatch(arr[0]);\n                }\n                resolve(arr);\n            });\n        });\n    };\n    React__namespace.useEffect(function () {\n        textContents.current = [];\n    }, [currentDocRef.current]);\n    return {\n        clearKeyword: clearKeyword,\n        changeMatchCase: changeMatchCase,\n        changeWholeWords: changeWholeWords,\n        currentMatch: currentMatch,\n        jumpToMatch: jumpToMatch,\n        jumpToNextMatch: jumpToNextMatch,\n        jumpToPreviousMatch: jumpToPreviousMatch,\n        keywords: keywords,\n        matchCase: matchCase,\n        numberOfMatches: found.length,\n        wholeWords: wholeWords,\n        search: search,\n        searchFor: searchFor,\n        setKeywords: setKeywords,\n        keyword: keywords.length === 0 ? '' : getKeywordSource(keywords[0]),\n        setKeyword: setKeyword,\n        setTargetPages: setTargetPages,\n    };\n};\n\nvar Search = function (_a) {\n    var children = _a.children, store = _a.store;\n    var result = useSearch(store);\n    var _b = React__namespace.useState(false), isDocumentLoaded = _b[0], setDocumentLoaded = _b[1];\n    var handleDocumentChanged = function (_) { return setDocumentLoaded(true); };\n    React__namespace.useEffect(function () {\n        store.subscribe('doc', handleDocumentChanged);\n        return function () {\n            store.unsubscribe('doc', handleDocumentChanged);\n        };\n    }, []);\n    return children(__assign(__assign({}, result), { isDocumentLoaded: isDocumentLoaded }));\n};\n\nvar ShortcutHandler = function (_a) {\n    var containerRef = _a.containerRef, store = _a.store;\n    var isMouseInsideRef = React__namespace.useRef(false);\n    var handleMouseEnter = function () {\n        isMouseInsideRef.current = true;\n    };\n    var handleMouseLeave = function () {\n        isMouseInsideRef.current = false;\n    };\n    var handleKeydown = function (e) {\n        var containerEle = containerRef.current;\n        if (!containerEle) {\n            return;\n        }\n        if (e.shiftKey || e.altKey || e.key !== 'f') {\n            return;\n        }\n        var isCommandPressed = core.isMac() ? e.metaKey && !e.ctrlKey : e.ctrlKey;\n        if (!isCommandPressed) {\n            return;\n        }\n        if (isMouseInsideRef.current || (document.activeElement && containerEle.contains(document.activeElement))) {\n            e.preventDefault();\n            store.update('areShortcutsPressed', true);\n        }\n    };\n    React__namespace.useEffect(function () {\n        var containerEle = containerRef.current;\n        if (!containerEle) {\n            return;\n        }\n        document.addEventListener('keydown', handleKeydown);\n        containerEle.addEventListener('mouseenter', handleMouseEnter);\n        containerEle.addEventListener('mouseleave', handleMouseLeave);\n        return function () {\n            document.removeEventListener('keydown', handleKeydown);\n            containerEle.removeEventListener('mouseenter', handleMouseEnter);\n            containerEle.removeEventListener('mouseleave', handleMouseLeave);\n        };\n    }, [containerRef.current]);\n    return React__namespace.createElement(React__namespace.Fragment, null);\n};\n\nvar PORTAL_OFFSET$1 = { left: 0, top: 8 };\nvar SearchPopover = function (_a) {\n    var store = _a.store, onToggle = _a.onToggle;\n    var l10n = React__namespace.useContext(core.LocalizationContext).l10n;\n    var direction = React__namespace.useContext(core.ThemeContext).direction;\n    var _b = React__namespace.useState(false), isQuerying = _b[0], setIsQuerying = _b[1];\n    var _c = React__namespace.useState(false), searchDone = _c[0], setSearchDone = _c[1];\n    var isRtl = direction === core.TextDirection.RightToLeft;\n    var _d = useSearch(store), clearKeyword = _d.clearKeyword, changeMatchCase = _d.changeMatchCase, changeWholeWords = _d.changeWholeWords, currentMatch = _d.currentMatch, jumpToNextMatch = _d.jumpToNextMatch, jumpToPreviousMatch = _d.jumpToPreviousMatch, keyword = _d.keyword, matchCase = _d.matchCase, numberOfMatches = _d.numberOfMatches, wholeWords = _d.wholeWords, search = _d.search, setKeyword = _d.setKeyword;\n    var performSearch = function (cb) {\n        setIsQuerying(true);\n        search().then(function (_) {\n            setIsQuerying(false);\n            setSearchDone(true);\n            cb && cb();\n        });\n    };\n    var onKeydownSearch = function (e) {\n        if (e.key === 'Enter' && keyword) {\n            searchDone ? jumpToNextMatch() : performSearch();\n        }\n    };\n    var onChangeMatchCase = function (e) {\n        setSearchDone(false);\n        changeMatchCase(e.target.checked);\n    };\n    var onChangeWholeWords = function (e) {\n        setSearchDone(false);\n        changeWholeWords(e.target.checked);\n    };\n    var onClose = function () {\n        onToggle();\n        clearKeyword();\n    };\n    var onChangeKeyword = function (value) {\n        setSearchDone(false);\n        setKeyword(value);\n    };\n    React__namespace.useEffect(function () {\n        var initialKeyword = store.get('initialKeyword');\n        if (initialKeyword && initialKeyword.length === 1 && keyword) {\n            performSearch(function () {\n                store.update('initialKeyword', []);\n            });\n        }\n    }, []);\n    var searchLabel = l10n && l10n.search ? l10n.search.enterToSearch : 'Enter to search';\n    var previousMatchLabel = l10n && l10n.search ? l10n.search.previousMatch : 'Previous match';\n    var nextMatchLabel = l10n && l10n.search ? l10n.search.nextMatch : 'Next match';\n    var closeButtonLabel = l10n && l10n.search ? l10n.search.close : 'Close';\n    return (React__namespace.createElement(\"div\", { className: \"rpv-search__popover\" },\n        React__namespace.createElement(\"div\", { className: \"rpv-search__popover-input-counter\" },\n            React__namespace.createElement(core.TextBox, { ariaLabel: searchLabel, autoFocus: true, placeholder: searchLabel, type: \"text\", value: keyword, onChange: onChangeKeyword, onKeyDown: onKeydownSearch }),\n            React__namespace.createElement(\"div\", { className: core.classNames({\n                    'rpv-search__popover-counter': true,\n                    'rpv-search__popover-counter--ltr': !isRtl,\n                    'rpv-search__popover-counter--rtl': isRtl,\n                }) },\n                isQuerying && React__namespace.createElement(core.Spinner, { testId: \"search__popover-searching\", size: \"1rem\" }),\n                !isQuerying && (React__namespace.createElement(\"span\", { \"data-testid\": \"search__popover-num-matches\" },\n                    currentMatch,\n                    \"/\",\n                    numberOfMatches)))),\n        React__namespace.createElement(\"label\", { className: \"rpv-search__popover-label\" },\n            React__namespace.createElement(\"input\", { className: \"rpv-search__popover-label-checkbox\", \"data-testid\": \"search__popover-match-case\", checked: matchCase, type: \"checkbox\", onChange: onChangeMatchCase }),\n            ' ',\n            l10n && l10n.search ? l10n.search.matchCase : 'Match case'),\n        React__namespace.createElement(\"label\", { className: \"rpv-search__popover-label\" },\n            React__namespace.createElement(\"input\", { className: \"rpv-search__popover-label-checkbox\", checked: wholeWords, \"data-testid\": \"search__popover-whole-words\", type: \"checkbox\", onChange: onChangeWholeWords }),\n            ' ',\n            l10n && l10n.search ? l10n.search.wholeWords : 'Whole words'),\n        React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer\" },\n            React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer-item\" },\n                React__namespace.createElement(core.Tooltip, { ariaControlsSuffix: \"search-previous-match\", position: isRtl ? core.Position.BottomRight : core.Position.BottomCenter, target: React__namespace.createElement(core.MinimalButton, { ariaLabel: previousMatchLabel, isDisabled: currentMatch <= 1, onClick: jumpToPreviousMatch },\n                        React__namespace.createElement(PreviousIcon, null)), content: function () { return previousMatchLabel; }, offset: PORTAL_OFFSET$1 })),\n            React__namespace.createElement(\"div\", { className: \"rpv-search__popover-footer-item\" },\n                React__namespace.createElement(core.Tooltip, { ariaControlsSuffix: \"search-next-match\", position: core.Position.BottomCenter, target: React__namespace.createElement(core.MinimalButton, { ariaLabel: nextMatchLabel, isDisabled: currentMatch > numberOfMatches - 1, onClick: jumpToNextMatch },\n                        React__namespace.createElement(NextIcon, null)), content: function () { return nextMatchLabel; }, offset: PORTAL_OFFSET$1 })),\n            React__namespace.createElement(\"div\", { className: core.classNames({\n                    'rpv-search__popover-footer-button': true,\n                    'rpv-search__popover-footer-button--ltr': !isRtl,\n                    'rpv-search__popover-footer-button--rtl': isRtl,\n                }) },\n                React__namespace.createElement(core.Button, { onClick: onClose }, closeButtonLabel)))));\n};\n\nvar ShowSearchPopoverDecorator = function (_a) {\n    var children = _a.children, onClick = _a.onClick;\n    var l10n = React__namespace.useContext(core.LocalizationContext).l10n;\n    var label = l10n && l10n.search ? l10n.search.search : 'Search';\n    var icon = React__namespace.createElement(SearchIcon, null);\n    return children({ icon: icon, label: label, onClick: onClick });\n};\n\nvar TOOLTIP_OFFSET = { left: 0, top: 8 };\nvar ShowSearchPopoverButton = function (_a) {\n    var enableShortcuts = _a.enableShortcuts, store = _a.store, onClick = _a.onClick;\n    var ariaKeyShortcuts = enableShortcuts ? (core.isMac() ? 'Meta+F' : 'Ctrl+F') : '';\n    var handleShortcutsPressed = function (areShortcutsPressed) {\n        if (areShortcutsPressed) {\n            onClick();\n        }\n    };\n    React__namespace.useEffect(function () {\n        store.subscribe('areShortcutsPressed', handleShortcutsPressed);\n        return function () {\n            store.unsubscribe('areShortcutsPressed', handleShortcutsPressed);\n        };\n    }, []);\n    return (React__namespace.createElement(ShowSearchPopoverDecorator, { onClick: onClick }, function (p) { return (React__namespace.createElement(core.Tooltip, { ariaControlsSuffix: \"search-popover\", position: core.Position.BottomCenter, target: React__namespace.createElement(core.MinimalButton, { ariaKeyShortcuts: ariaKeyShortcuts, ariaLabel: p.label, testId: \"search__popover-button\", onClick: onClick }, p.icon), content: function () { return p.label; }, offset: TOOLTIP_OFFSET })); }));\n};\n\nvar PORTAL_OFFSET = { left: 0, top: 8 };\nvar ShowSearchPopover = function (_a) {\n    var children = _a.children, enableShortcuts = _a.enableShortcuts, store = _a.store;\n    var direction = React__namespace.useContext(core.ThemeContext).direction;\n    var portalPosition = direction === core.TextDirection.RightToLeft ? core.Position.BottomRight : core.Position.BottomLeft;\n    var defaultChildren = function (props) { return (React__namespace.createElement(ShowSearchPopoverButton, __assign({ enableShortcuts: enableShortcuts, store: store }, props))); };\n    var render = children || defaultChildren;\n    return (React__namespace.createElement(core.Popover, { ariaControlsSuffix: \"search\", lockScroll: false, position: portalPosition, target: function (toggle) {\n            return render({\n                onClick: toggle,\n            });\n        }, content: function (toggle) { return React__namespace.createElement(SearchPopover, { store: store, onToggle: toggle }); }, offset: PORTAL_OFFSET, closeOnClickOutside: false, closeOnEscape: true }));\n};\n\nvar normalizeKeywords = function (keyword) {\n    return Array.isArray(keyword) ? keyword.map(function (k) { return normalizeSingleKeyword(k); }) : [normalizeSingleKeyword(keyword)];\n};\nvar searchPlugin = function (props) {\n    var searchPluginProps = React__namespace.useMemo(function () { return Object.assign({}, { enableShortcuts: true, onHighlightKeyword: function () { } }, props); }, []);\n    var store = React__namespace.useMemo(function () {\n        return core.createStore({\n            initialKeyword: props && props.keyword ? (Array.isArray(props.keyword) ? props.keyword : [props.keyword]) : [],\n            keyword: props && props.keyword ? normalizeKeywords(props.keyword) : [EMPTY_KEYWORD_REGEXP],\n            matchPosition: {\n                matchIndex: -1,\n                pageIndex: -1,\n            },\n            renderStatus: new Map(),\n        });\n    }, []);\n    var _a = useSearch(store), clearKeyword = _a.clearKeyword, jumpToMatch = _a.jumpToMatch, jumpToNextMatch = _a.jumpToNextMatch, jumpToPreviousMatch = _a.jumpToPreviousMatch, searchFor = _a.searchFor, setKeywords = _a.setKeywords, setTargetPages = _a.setTargetPages;\n    var SearchDecorator = function (props) { return React__namespace.createElement(Search, __assign({}, props, { store: store })); };\n    var ShowSearchPopoverDecorator = function (props) { return (React__namespace.createElement(ShowSearchPopover, __assign({ enableShortcuts: searchPluginProps.enableShortcuts }, props, { store: store }))); };\n    var ShowSearchPopoverButtonDecorator = function () { return (React__namespace.createElement(ShowSearchPopoverDecorator, null, function (props) { return (React__namespace.createElement(ShowSearchPopoverButton, __assign({ enableShortcuts: searchPluginProps.enableShortcuts, store: store }, props))); })); };\n    var renderViewer = function (renderViewerProps) {\n        var currentSlot = renderViewerProps.slot;\n        if (currentSlot.subSlot) {\n            currentSlot.subSlot.children = (React__namespace.createElement(React__namespace.Fragment, null,\n                searchPluginProps.enableShortcuts && (React__namespace.createElement(ShortcutHandler, { containerRef: renderViewerProps.containerRef, store: store })),\n                currentSlot.subSlot.children));\n        }\n        return currentSlot;\n    };\n    var renderPageLayer = function (renderProps) { return (React__namespace.createElement(Highlights, { key: renderProps.pageIndex, numPages: renderProps.doc.numPages, pageIndex: renderProps.pageIndex, renderHighlights: props === null || props === void 0 ? void 0 : props.renderHighlights, store: store, onHighlightKeyword: searchPluginProps.onHighlightKeyword })); };\n    return {\n        install: function (pluginFunctions) {\n            var initialKeyword = props && props.keyword ? (Array.isArray(props.keyword) ? props.keyword : [props.keyword]) : [];\n            var keyword = props && props.keyword ? normalizeKeywords(props.keyword) : [EMPTY_KEYWORD_REGEXP];\n            store.update('initialKeyword', initialKeyword);\n            store.update('jumpToDestination', pluginFunctions.jumpToDestination);\n            store.update('jumpToPage', pluginFunctions.jumpToPage);\n            store.update('keyword', keyword);\n        },\n        renderPageLayer: renderPageLayer,\n        renderViewer: renderViewer,\n        uninstall: function (props) {\n            var renderStatus = store.get('renderStatus');\n            if (renderStatus) {\n                renderStatus.clear();\n            }\n        },\n        onDocumentLoad: function (props) {\n            store.update('doc', props.doc);\n        },\n        onTextLayerRender: function (props) {\n            var renderStatus = store.get('renderStatus');\n            if (renderStatus) {\n                renderStatus = renderStatus.set(props.pageIndex, props);\n                store.update('renderStatus', renderStatus);\n            }\n        },\n        Search: SearchDecorator,\n        ShowSearchPopover: ShowSearchPopoverDecorator,\n        ShowSearchPopoverButton: ShowSearchPopoverButtonDecorator,\n        clearHighlights: function () {\n            clearKeyword();\n        },\n        highlight: function (keyword) {\n            var keywords = Array.isArray(keyword) ? keyword : [keyword];\n            setKeywords(keywords);\n            return searchFor(keywords);\n        },\n        jumpToMatch: jumpToMatch,\n        jumpToNextMatch: jumpToNextMatch,\n        jumpToPreviousMatch: jumpToPreviousMatch,\n        setTargetPages: setTargetPages,\n    };\n};\n\nexports.NextIcon = NextIcon;\nexports.PreviousIcon = PreviousIcon;\nexports.SearchIcon = SearchIcon;\nexports.searchPlugin = searchPlugin;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQHJlYWN0LXBkZi12aWV3ZXIrc2VhcmNoQDMuMTIuMF9wZGZqcy1kaXN0QDMuNC4xMjBfcmVhY3QtZG9tQDE5LjAuMF9yZWFjdEAxOS4wLjBfX3JlYWN0QDE5LjAuMC9ub2RlX21vZHVsZXMvQHJlYWN0LXBkZi12aWV3ZXIvc2VhcmNoL2xpYi9janMvc2VhcmNoLmpzIiwibWFwcGluZ3MiOiJBQUFhOztBQUViLFdBQVcsbUJBQU8sQ0FBQyx3TUFBd0I7QUFDM0MsWUFBWSxtQkFBTyxDQUFDLCtMQUFPOztBQUUzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSw2QkFBNkIsb0RBQW9ELFVBQVU7QUFDM0YsNkNBQTZDLGlJQUFpSTs7QUFFOUssaUNBQWlDLG9EQUFvRCxVQUFVO0FBQy9GLDZDQUE2QyxtSUFBbUk7O0FBRWhMLCtCQUErQixvREFBb0QsaUNBQWlDO0FBQ3BILDZDQUE2Qyw4SUFBOEk7O0FBRTNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsT0FBTztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxLQUFLO0FBQ0wsb0RBQW9ELDBJQUEwSTtBQUM5TDs7QUFF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QTZDLHlEQUF5RCxXQUFXLGNBQWM7QUFDL0gsd0RBQXdELHFFQUFxRSxvREFBb0QsV0FBVyxjQUFjO0FBQzFNLHlEQUF5RCw0RkFBNEYsMkVBQTJFLGtFQUFrRSxhQUFhO0FBQy9TO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0dBQXdHLDREQUE0RDtBQUNwSztBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxxREFBcUQsa1FBQWtRO0FBQzFXO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsZ0JBQWdCO0FBQ2hCLG9CQUFvQjtBQUNwQixrQkFBa0I7QUFDbEIsb0JBQW9CIiwic291cmNlcyI6WyIvaG9tZS9ub2UtY2FtcG8vZGVsb3MvcHJvamV0L2xhYi1rcy9rcy1sYWIvbm9kZV9tb2R1bGVzLy5wbnBtL0ByZWFjdC1wZGYtdmlld2VyK3NlYXJjaEAzLjEyLjBfcGRmanMtZGlzdEAzLjQuMTIwX3JlYWN0LWRvbUAxOS4wLjBfcmVhY3RAMTkuMC4wX19yZWFjdEAxOS4wLjAvbm9kZV9tb2R1bGVzL0ByZWFjdC1wZGYtdmlld2VyL3NlYXJjaC9saWIvY2pzL3NlYXJjaC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBjb3JlID0gcmVxdWlyZSgnQHJlYWN0LXBkZi12aWV3ZXIvY29yZScpO1xudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcblxuZnVuY3Rpb24gX2ludGVyb3BOYW1lc3BhY2VEZWZhdWx0KGUpIHtcbiAgICB2YXIgbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgaWYgKGUpIHtcbiAgICAgICAgT2JqZWN0LmtleXMoZSkuZm9yRWFjaChmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgaWYgKGsgIT09ICdkZWZhdWx0Jykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCBrKTtcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobiwgaywgZC5nZXQgPyBkIDoge1xuICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVba107IH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG4uZGVmYXVsdCA9IGU7XG4gICAgcmV0dXJuIE9iamVjdC5mcmVlemUobik7XG59XG5cbnZhciBSZWFjdF9fbmFtZXNwYWNlID0gLyojX19QVVJFX18qL19pbnRlcm9wTmFtZXNwYWNlRGVmYXVsdChSZWFjdCk7XG5cbnZhciBOZXh0SWNvbiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoY29yZS5JY29uLCB7IHNpemU6IDE2IH0sXG4gICAgUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7IGQ6IFwiTTAuNTQxLDUuNjI3TDExLjY2NiwxOC4yYzAuMTgzLDAuMjA3LDAuNDk5LDAuMjI2LDAuNzA2LDAuMDQzYzAuMDE1LTAuMDE0LDAuMDMtMC4wMjgsMC4wNDMtMC4wNDNcXG4gICAgICAgICAgICBMMjMuNTQxLDUuNjI3XCIgfSkpKTsgfTtcblxudmFyIFByZXZpb3VzSWNvbiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoY29yZS5JY29uLCB7IHNpemU6IDE2IH0sXG4gICAgUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFwicGF0aFwiLCB7IGQ6IFwiTTIzLjUzNSwxOC4zNzNMMTIuNDA5LDUuOGMtMC4xODMtMC4yMDctMC40OTktMC4yMjYtMC43MDYtMC4wNDNDMTEuNjg4LDUuNzcsMTEuNjc0LDUuNzg1LDExLjY2LDUuOFxcbiAgICAgICAgICAgIEwwLjUzNSwxOC4zNzNcIiB9KSkpOyB9O1xuXG52YXIgU2VhcmNoSWNvbiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoY29yZS5JY29uLCB7IGlnbm9yZURpcmVjdGlvbjogdHJ1ZSwgc2l6ZTogMTYgfSxcbiAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJwYXRoXCIsIHsgZDogXCJNMTAuNSwwLjVjNS41MjMsMCwxMCw0LjQ3NywxMCwxMHMtNC40NzcsMTAtMTAsMTBzLTEwLTQuNDc3LTEwLTEwUzQuOTc3LDAuNSwxMC41LDAuNXpcXG4gICAgICAgICAgICBNMjMuNSwyMy41XFxuICAgICAgICAgICAgbC01LjkyOS01LjkyOVwiIH0pKSk7IH07XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG5cclxudmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcblxudmFyIEVNUFRZX0tFWVdPUkRfUkVHRVhQID0ge1xuICAgIGtleXdvcmQ6ICcnLFxuICAgIHJlZ0V4cDogbmV3IFJlZ0V4cCgnICcpLFxuICAgIHdob2xlV29yZHM6IGZhbHNlLFxufTtcblxudmFyIGNhbGN1bGF0ZU9mZnNldCA9IGZ1bmN0aW9uIChjaGlsZHJlbiwgcGFyZW50KSB7XG4gICAgdmFyIHRvcCA9IGNoaWxkcmVuLm9mZnNldFRvcDtcbiAgICB2YXIgbGVmdCA9IGNoaWxkcmVuLm9mZnNldExlZnQ7XG4gICAgdmFyIHAgPSBjaGlsZHJlbi5wYXJlbnRFbGVtZW50O1xuICAgIHdoaWxlIChwICYmIHAgIT09IHBhcmVudCkge1xuICAgICAgICB0b3AgKz0gcC5vZmZzZXRUb3A7XG4gICAgICAgIGxlZnQgKz0gcC5vZmZzZXRMZWZ0O1xuICAgICAgICBwID0gcC5wYXJlbnRFbGVtZW50O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBsZWZ0OiBsZWZ0LFxuICAgICAgICB0b3A6IHRvcCxcbiAgICB9O1xufTtcblxudmFyIGdldENzc1Byb3BlcnRpZXMgPSBmdW5jdGlvbiAoYXJlYSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IFwiXCIuY29uY2F0KGFyZWEubGVmdCwgXCIlXCIpLFxuICAgICAgICB0b3A6IFwiXCIuY29uY2F0KGFyZWEudG9wLCBcIiVcIiksXG4gICAgICAgIGhlaWdodDogXCJcIi5jb25jYXQoYXJlYS5oZWlnaHQsIFwiJVwiKSxcbiAgICAgICAgd2lkdGg6IFwiXCIuY29uY2F0KGFyZWEud2lkdGgsIFwiJVwiKSxcbiAgICB9O1xufTtcblxudmFyIEhpZ2h0bGlnaHRJdGVtID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIGluZGV4ID0gX2EuaW5kZXgsIGFyZWEgPSBfYS5hcmVhLCBvbkhpZ2hsaWdodEtleXdvcmQgPSBfYS5vbkhpZ2hsaWdodEtleXdvcmQ7XG4gICAgdmFyIGNvbnRhaW5lclJlZiA9IFJlYWN0X19uYW1lc3BhY2UudXNlUmVmKCk7XG4gICAgY29yZS51c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhpZ2hsaWdodEVsZSA9IGNvbnRhaW5lclJlZi5jdXJyZW50O1xuICAgICAgICBpZiAob25IaWdobGlnaHRLZXl3b3JkICYmIGhpZ2hsaWdodEVsZSkge1xuICAgICAgICAgICAgb25IaWdobGlnaHRLZXl3b3JkKHtcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRFbGU6IGhpZ2hsaWdodEVsZSxcbiAgICAgICAgICAgICAgICBrZXl3b3JkOiBhcmVhLmtleXdvcmQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sIFtdKTtcbiAgICByZXR1cm4gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJycHYtc2VhcmNoX19oaWdobGlnaHRcIiwgXCJkYXRhLWluZGV4XCI6IGluZGV4LCByZWY6IGNvbnRhaW5lclJlZiwgc3R5bGU6IGdldENzc1Byb3BlcnRpZXMoYXJlYSksIHRpdGxlOiBhcmVhLmtleXdvcmRTdHIudHJpbSgpIH0pKTtcbn07XG5cbnZhciByZW1vdmVOb2RlID0gZnVuY3Rpb24gKGVsZSkge1xuICAgIHZhciBwYXJlbnQgPSBlbGUucGFyZW50Tm9kZTtcbiAgICBpZiAocGFyZW50KSB7XG4gICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChlbGUpO1xuICAgIH1cbn07XG52YXIgcmVwbGFjZU5vZGUgPSBmdW5jdGlvbiAocmVwbGFjZW1lbnROb2RlLCBub2RlKSB7XG4gICAgcmVtb3ZlTm9kZShyZXBsYWNlbWVudE5vZGUpO1xuICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgaWYgKHBhcmVudCkge1xuICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKHJlcGxhY2VtZW50Tm9kZSwgbm9kZSk7XG4gICAgfVxuICAgIHJlbW92ZU5vZGUobm9kZSk7XG59O1xudmFyIHVud3JhcCA9IGZ1bmN0aW9uIChlbGUpIHtcbiAgICB2YXIgcGFyZW50ID0gZWxlLnBhcmVudE5vZGU7XG4gICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhlbGUpO1xuICAgIHJlcGxhY2VOb2RlKHJhbmdlLmV4dHJhY3RDb250ZW50cygpLCBlbGUpO1xuICAgIHBhcmVudC5ub3JtYWxpemUoKTtcbn07XG5cbnZhciBzb3J0SGlnaGxpZ2h0UG9zaXRpb24gPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIGlmIChhLnRvcCA8IGIudG9wKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaWYgKGEudG9wID4gYi50b3ApIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGlmIChhLmxlZnQgPCBiLmxlZnQpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoYS5sZWZ0ID4gYi5sZWZ0KSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbn07XG52YXIgSGlnaGxpZ2h0cyA9IGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBudW1QYWdlcyA9IF9hLm51bVBhZ2VzLCBwYWdlSW5kZXggPSBfYS5wYWdlSW5kZXgsIHJlbmRlckhpZ2hsaWdodHMgPSBfYS5yZW5kZXJIaWdobGlnaHRzLCBzdG9yZSA9IF9hLnN0b3JlLCBvbkhpZ2hsaWdodEtleXdvcmQgPSBfYS5vbkhpZ2hsaWdodEtleXdvcmQ7XG4gICAgdmFyIGNvbnRhaW5lclJlZiA9IFJlYWN0X19uYW1lc3BhY2UudXNlUmVmKCk7XG4gICAgdmFyIGRlZmF1bHRSZW5kZXJIaWdobGlnaHRzID0gUmVhY3RfX25hbWVzcGFjZS51c2VDYWxsYmFjayhmdW5jdGlvbiAocmVuZGVyUHJvcHMpIHsgcmV0dXJuIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoUmVhY3RfX25hbWVzcGFjZS5GcmFnbWVudCwgbnVsbCwgcmVuZGVyUHJvcHMuaGlnaGxpZ2h0QXJlYXMubWFwKGZ1bmN0aW9uIChhcmVhLCBpbmRleCkgeyByZXR1cm4gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChIaWdodGxpZ2h0SXRlbSwgeyBpbmRleDogaW5kZXgsIGtleTogaW5kZXgsIGFyZWE6IGFyZWEsIG9uSGlnaGxpZ2h0S2V5d29yZDogb25IaWdobGlnaHRLZXl3b3JkIH0pKTsgfSkpKTsgfSwgW10pO1xuICAgIHZhciByZW5kZXJIaWdobGlnaHRFbGVtZW50cyA9IHJlbmRlckhpZ2hsaWdodHMgfHwgZGVmYXVsdFJlbmRlckhpZ2hsaWdodHM7XG4gICAgdmFyIF9iID0gUmVhY3RfX25hbWVzcGFjZS51c2VTdGF0ZShzdG9yZS5nZXQoJ21hdGNoUG9zaXRpb24nKSksIG1hdGNoUG9zaXRpb24gPSBfYlswXSwgc2V0TWF0Y2hQb3NpdGlvbiA9IF9iWzFdO1xuICAgIHZhciBfYyA9IFJlYWN0X19uYW1lc3BhY2UudXNlU3RhdGUoc3RvcmUuZ2V0KCdrZXl3b3JkJykgfHwgW0VNUFRZX0tFWVdPUkRfUkVHRVhQXSksIGtleXdvcmRSZWdleHAgPSBfY1swXSwgc2V0S2V5d29yZFJlZ2V4cCA9IF9jWzFdO1xuICAgIHZhciBfZCA9IFJlYWN0X19uYW1lc3BhY2UudXNlU3RhdGUoe1xuICAgICAgICBwYWdlSW5kZXg6IHBhZ2VJbmRleCxcbiAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgIHN0YXR1czogY29yZS5MYXllclJlbmRlclN0YXR1cy5QcmVSZW5kZXIsXG4gICAgfSksIHJlbmRlclN0YXR1cyA9IF9kWzBdLCBzZXRSZW5kZXJTdGF0dXMgPSBfZFsxXTtcbiAgICB2YXIgY3VycmVudE1hdGNoUmVmID0gUmVhY3RfX25hbWVzcGFjZS51c2VSZWYobnVsbCk7XG4gICAgdmFyIGNoYXJhY3RlckluZGV4ZXNSZWYgPSBSZWFjdF9fbmFtZXNwYWNlLnVzZVJlZihbXSk7XG4gICAgdmFyIF9lID0gUmVhY3RfX25hbWVzcGFjZS51c2VTdGF0ZShbXSksIGhpZ2hsaWdodEFyZWFzID0gX2VbMF0sIHNldEhpZ2hsaWdodEFyZWFzID0gX2VbMV07XG4gICAgdmFyIGRlZmF1bHRUYXJnZXRQYWdlRmlsdGVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJ1ZTsgfTtcbiAgICB2YXIgdGFyZ2V0UGFnZUZpbHRlciA9IFJlYWN0X19uYW1lc3BhY2UudXNlQ2FsbGJhY2soZnVuY3Rpb24gKCkgeyByZXR1cm4gc3RvcmUuZ2V0KCd0YXJnZXRQYWdlRmlsdGVyJykgfHwgZGVmYXVsdFRhcmdldFBhZ2VGaWx0ZXI7IH0sIFtzdG9yZS5nZXQoJ3RhcmdldFBhZ2VGaWx0ZXInKV0pO1xuICAgIHZhciBoaWdobGlnaHQgPSBmdW5jdGlvbiAoa2V5d29yZFN0ciwga2V5d29yZCwgdGV4dExheWVyRWxlLCBzcGFuLCBjaGFySW5kZXhTcGFuKSB7XG4gICAgICAgIHZhciByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIHZhciBmaXJzdENoaWxkID0gc3Bhbi5maXJzdENoaWxkO1xuICAgICAgICBpZiAoIWZpcnN0Q2hpbGQgfHwgZmlyc3RDaGlsZC5ub2RlVHlwZSAhPT0gTm9kZS5URVhUX05PREUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsZW5ndGggPSBmaXJzdENoaWxkLnRleHRDb250ZW50Lmxlbmd0aDtcbiAgICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gY2hhckluZGV4U3BhblswXS5jaGFySW5kZXhJblNwYW47XG4gICAgICAgIHZhciBlbmRPZmZzZXQgPSBjaGFySW5kZXhTcGFuLmxlbmd0aCA9PT0gMSA/IHN0YXJ0T2Zmc2V0IDogY2hhckluZGV4U3BhbltjaGFySW5kZXhTcGFuLmxlbmd0aCAtIDFdLmNoYXJJbmRleEluU3BhbjtcbiAgICAgICAgaWYgKHN0YXJ0T2Zmc2V0ID4gbGVuZ3RoIHx8IGVuZE9mZnNldCArIDEgPiBsZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJhbmdlLnNldFN0YXJ0KGZpcnN0Q2hpbGQsIHN0YXJ0T2Zmc2V0KTtcbiAgICAgICAgcmFuZ2Uuc2V0RW5kKGZpcnN0Q2hpbGQsIGVuZE9mZnNldCArIDEpO1xuICAgICAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgcmFuZ2Uuc3Vycm91bmRDb250ZW50cyh3cmFwcGVyKTtcbiAgICAgICAgdmFyIHdyYXBwZXJSZWN0ID0gd3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgdmFyIHRleHRMYXllclJlY3QgPSB0ZXh0TGF5ZXJFbGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIHZhciBwYWdlSGVpZ2h0ID0gdGV4dExheWVyUmVjdC5oZWlnaHQ7XG4gICAgICAgIHZhciBwYWdlV2lkdGggPSB0ZXh0TGF5ZXJSZWN0LndpZHRoO1xuICAgICAgICB2YXIgbGVmdCA9ICgxMDAgKiAod3JhcHBlclJlY3QubGVmdCAtIHRleHRMYXllclJlY3QubGVmdCkpIC8gcGFnZVdpZHRoO1xuICAgICAgICB2YXIgdG9wID0gKDEwMCAqICh3cmFwcGVyUmVjdC50b3AgLSB0ZXh0TGF5ZXJSZWN0LnRvcCkpIC8gcGFnZUhlaWdodDtcbiAgICAgICAgdmFyIGhlaWdodCA9ICgxMDAgKiB3cmFwcGVyUmVjdC5oZWlnaHQpIC8gcGFnZUhlaWdodDtcbiAgICAgICAgdmFyIHdpZHRoID0gKDEwMCAqIHdyYXBwZXJSZWN0LndpZHRoKSAvIHBhZ2VXaWR0aDtcbiAgICAgICAgdW53cmFwKHdyYXBwZXIpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5d29yZDoga2V5d29yZCxcbiAgICAgICAgICAgIGtleXdvcmRTdHI6IGtleXdvcmRTdHIsXG4gICAgICAgICAgICBudW1QYWdlczogbnVtUGFnZXMsXG4gICAgICAgICAgICBwYWdlSW5kZXg6IHBhZ2VJbmRleCxcbiAgICAgICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgICAgICB0b3A6IHRvcCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgcGFnZUhlaWdodDogcGFnZUhlaWdodCxcbiAgICAgICAgICAgIHBhZ2VXaWR0aDogcGFnZVdpZHRoLFxuICAgICAgICB9O1xuICAgIH07XG4gICAgdmFyIGhpZ2hsaWdodEFsbCA9IGZ1bmN0aW9uICh0ZXh0TGF5ZXJFbGUpIHtcbiAgICAgICAgdmFyIGNoYXJJbmRleGVzID0gY2hhcmFjdGVySW5kZXhlc1JlZi5jdXJyZW50O1xuICAgICAgICBpZiAoY2hhckluZGV4ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhpZ2hsaWdodFBvcyA9IFtdO1xuICAgICAgICB2YXIgc3BhbnMgPSBbXS5zbGljZS5jYWxsKHRleHRMYXllckVsZS5xdWVyeVNlbGVjdG9yQWxsKCcucnB2LWNvcmVfX3RleHQtbGF5ZXItdGV4dCcpKTtcbiAgICAgICAgdmFyIGZ1bGxUZXh0ID0gY2hhckluZGV4ZXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7IHJldHVybiBpdGVtLmNoYXI7IH0pLmpvaW4oJycpO1xuICAgICAgICBrZXl3b3JkUmVnZXhwLmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmQpIHtcbiAgICAgICAgICAgIHZhciBrZXl3b3JkU3RyID0ga2V5d29yZC5rZXl3b3JkO1xuICAgICAgICAgICAgaWYgKCFrZXl3b3JkU3RyLnRyaW0oKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjbG9uZUtleXdvcmQgPSBrZXl3b3JkLnJlZ0V4cC5mbGFncy5pbmRleE9mKCdnJykgPT09IC0xXG4gICAgICAgICAgICAgICAgPyBuZXcgUmVnRXhwKGtleXdvcmQucmVnRXhwLCBcIlwiLmNvbmNhdChrZXl3b3JkLnJlZ0V4cC5mbGFncywgXCJnXCIpKVxuICAgICAgICAgICAgICAgIDoga2V5d29yZC5yZWdFeHA7XG4gICAgICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IFtdO1xuICAgICAgICAgICAgd2hpbGUgKChtYXRjaCA9IGNsb25lS2V5d29yZC5leGVjKGZ1bGxUZXh0KSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBrZXl3b3JkOiBjbG9uZUtleXdvcmQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IG1hdGNoLmluZGV4LFxuICAgICAgICAgICAgICAgICAgICBlbmRJbmRleDogY2xvbmVLZXl3b3JkLmxhc3RJbmRleCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1hdGNoZXNcbiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChpdGVtKSB7IHJldHVybiAoe1xuICAgICAgICAgICAgICAgIGtleXdvcmQ6IGl0ZW0ua2V5d29yZCxcbiAgICAgICAgICAgICAgICBpbmRleGVzOiBjaGFySW5kZXhlcy5zbGljZShpdGVtLnN0YXJ0SW5kZXgsIGl0ZW0uZW5kSW5kZXgpLFxuICAgICAgICAgICAgfSk7IH0pXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3BhbkluZGV4ZXMgPSBpdGVtLmluZGV4ZXMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgYWNjW2l0ZW0uc3BhbkluZGV4XSA9IChhY2NbaXRlbS5zcGFuSW5kZXhdIHx8IFtdKS5jb25jYXQoW2l0ZW1dKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgICAgICB9LCB7fSk7XG4gICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhzcGFuSW5kZXhlcykuZm9yRWFjaChmdW5jdGlvbiAoY2hhckluZGV4U3Bhbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhckluZGV4U3Bhbi5sZW5ndGggIT09IDEgfHwgY2hhckluZGV4U3BhblswXS5jaGFyLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub3JtYWxpemVkQ2hhclNwYW4gPSBrZXl3b3JkLndob2xlV29yZHMgPyBjaGFySW5kZXhTcGFuLnNsaWNlKDEsIC0xKSA6IGNoYXJJbmRleFNwYW47XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGlnaHRsaWdoUG9zaXRpb24gPSBoaWdobGlnaHQoa2V5d29yZFN0ciwgaXRlbS5rZXl3b3JkLCB0ZXh0TGF5ZXJFbGUsIHNwYW5zW25vcm1hbGl6ZWRDaGFyU3BhblswXS5zcGFuSW5kZXhdLCBub3JtYWxpemVkQ2hhclNwYW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpZ2h0bGlnaFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0UG9zLnB1c2goaGlnaHRsaWdoUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBoaWdobGlnaHRQb3Muc29ydChzb3J0SGlnaGxpZ2h0UG9zaXRpb24pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZUtleXdvcmRDaGFuZ2VkID0gZnVuY3Rpb24gKGtleXdvcmQpIHtcbiAgICAgICAgaWYgKGtleXdvcmQgJiYga2V5d29yZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXRLZXl3b3JkUmVnZXhwKGtleXdvcmQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlTWF0Y2hQb3NpdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAoY3VycmVudFBvc2l0aW9uKSB7IHJldHVybiBzZXRNYXRjaFBvc2l0aW9uKGN1cnJlbnRQb3NpdGlvbik7IH07XG4gICAgdmFyIGhhbmRsZVJlbmRlclN0YXR1c0NoYW5nZWQgPSBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgIGlmICghc3RhdHVzLmhhcyhwYWdlSW5kZXgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGN1cnJlbnRTdGF0dXMgPSBzdGF0dXMuZ2V0KHBhZ2VJbmRleCk7XG4gICAgICAgIGlmIChjdXJyZW50U3RhdHVzKSB7XG4gICAgICAgICAgICBzZXRSZW5kZXJTdGF0dXMoe1xuICAgICAgICAgICAgICAgIGVsZTogY3VycmVudFN0YXR1cy5lbGUsXG4gICAgICAgICAgICAgICAgcGFnZUluZGV4OiBwYWdlSW5kZXgsXG4gICAgICAgICAgICAgICAgc2NhbGU6IGN1cnJlbnRTdGF0dXMuc2NhbGUsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBjdXJyZW50U3RhdHVzLnN0YXR1cyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgaXNFbXB0eUtleXdvcmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBrZXl3b3JkUmVnZXhwLmxlbmd0aCA9PT0gMCB8fCAoa2V5d29yZFJlZ2V4cC5sZW5ndGggPT09IDEgJiYga2V5d29yZFJlZ2V4cFswXS5rZXl3b3JkLnRyaW0oKSA9PT0gJycpO1xuICAgIH07XG4gICAgUmVhY3RfX25hbWVzcGFjZS51c2VFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNFbXB0eUtleXdvcmQoKSB8fFxuICAgICAgICAgICAgcmVuZGVyU3RhdHVzLnN0YXR1cyAhPT0gY29yZS5MYXllclJlbmRlclN0YXR1cy5EaWRSZW5kZXIgfHxcbiAgICAgICAgICAgIGNoYXJhY3RlckluZGV4ZXNSZWYuY3VycmVudC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGV4dExheWVyRWxlID0gcmVuZGVyU3RhdHVzLmVsZTtcbiAgICAgICAgdmFyIHNwYW5zID0gW10uc2xpY2UuY2FsbCh0ZXh0TGF5ZXJFbGUucXVlcnlTZWxlY3RvckFsbCgnLnJwdi1jb3JlX190ZXh0LWxheWVyLXRleHQnKSk7XG4gICAgICAgIHZhciBjaGFySW5kZXhlcyA9IHNwYW5zXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChzcGFuKSB7IHJldHVybiBzcGFuLnRleHRDb250ZW50OyB9KVxuICAgICAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAocHJldiwgY3VyciwgaW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmV2LmNvbmNhdChjdXJyLnNwbGl0KCcnKS5tYXAoZnVuY3Rpb24gKGMsIGkpIHsgcmV0dXJuICh7XG4gICAgICAgICAgICAgICAgY2hhcjogYyxcbiAgICAgICAgICAgICAgICBjaGFySW5kZXhJblNwYW46IGksXG4gICAgICAgICAgICAgICAgc3BhbkluZGV4OiBpbmRleCxcbiAgICAgICAgICAgIH0pOyB9KSk7XG4gICAgICAgIH0sIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjaGFyOiAnJyxcbiAgICAgICAgICAgICAgICBjaGFySW5kZXhJblNwYW46IDAsXG4gICAgICAgICAgICAgICAgc3BhbkluZGV4OiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSlcbiAgICAgICAgICAgIC5zbGljZSgxKTtcbiAgICAgICAgY2hhcmFjdGVySW5kZXhlc1JlZi5jdXJyZW50ID0gY2hhckluZGV4ZXM7XG4gICAgfSwgW2tleXdvcmRSZWdleHAsIHJlbmRlclN0YXR1cy5zdGF0dXNdKTtcbiAgICBSZWFjdF9fbmFtZXNwYWNlLnVzZUVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChpc0VtcHR5S2V5d29yZCgpIHx8XG4gICAgICAgICAgICAhcmVuZGVyU3RhdHVzLmVsZSB8fFxuICAgICAgICAgICAgcmVuZGVyU3RhdHVzLnN0YXR1cyAhPT0gY29yZS5MYXllclJlbmRlclN0YXR1cy5EaWRSZW5kZXIgfHxcbiAgICAgICAgICAgICF0YXJnZXRQYWdlRmlsdGVyKCkoeyBwYWdlSW5kZXg6IHBhZ2VJbmRleCwgbnVtUGFnZXM6IG51bVBhZ2VzIH0pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRleHRMYXllckVsZSA9IHJlbmRlclN0YXR1cy5lbGU7XG4gICAgICAgIHZhciBoaWdobGlnaHRQb3MgPSBoaWdobGlnaHRBbGwodGV4dExheWVyRWxlKTtcbiAgICAgICAgc2V0SGlnaGxpZ2h0QXJlYXMoaGlnaGxpZ2h0UG9zKTtcbiAgICB9LCBba2V5d29yZFJlZ2V4cCwgbWF0Y2hQb3NpdGlvbiwgcmVuZGVyU3RhdHVzLnN0YXR1cywgY2hhcmFjdGVySW5kZXhlc1JlZi5jdXJyZW50XSk7XG4gICAgUmVhY3RfX25hbWVzcGFjZS51c2VFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNFbXB0eUtleXdvcmQoKSAmJiByZW5kZXJTdGF0dXMuZWxlICYmIHJlbmRlclN0YXR1cy5zdGF0dXMgPT09IGNvcmUuTGF5ZXJSZW5kZXJTdGF0dXMuRGlkUmVuZGVyKSB7XG4gICAgICAgICAgICBzZXRIaWdobGlnaHRBcmVhcyhbXSk7XG4gICAgICAgIH1cbiAgICB9LCBba2V5d29yZFJlZ2V4cCwgcmVuZGVyU3RhdHVzLnN0YXR1c10pO1xuICAgIFJlYWN0X19uYW1lc3BhY2UudXNlRWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGhpZ2hsaWdodEFyZWFzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb250YWluZXIgPSBjb250YWluZXJSZWYuY3VycmVudDtcbiAgICAgICAgaWYgKG1hdGNoUG9zaXRpb24ucGFnZUluZGV4ICE9PSBwYWdlSW5kZXggfHxcbiAgICAgICAgICAgICFjb250YWluZXIgfHxcbiAgICAgICAgICAgIHJlbmRlclN0YXR1cy5zdGF0dXMgIT09IGNvcmUuTGF5ZXJSZW5kZXJTdGF0dXMuRGlkUmVuZGVyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhpZ2hsaWdodEVsZSA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLnJwdi1zZWFyY2hfX2hpZ2hsaWdodFtkYXRhLWluZGV4PVxcXCJcIi5jb25jYXQobWF0Y2hQb3NpdGlvbi5tYXRjaEluZGV4LCBcIlxcXCJdXCIpKTtcbiAgICAgICAgaWYgKCFoaWdobGlnaHRFbGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX2EgPSBjYWxjdWxhdGVPZmZzZXQoaGlnaGxpZ2h0RWxlLCBjb250YWluZXIpLCBsZWZ0ID0gX2EubGVmdCwgdG9wID0gX2EudG9wO1xuICAgICAgICB2YXIganVtcCA9IHN0b3JlLmdldCgnanVtcFRvRGVzdGluYXRpb24nKTtcbiAgICAgICAgaWYgKGp1bXApIHtcbiAgICAgICAgICAgIGp1bXAoe1xuICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogcGFnZUluZGV4LFxuICAgICAgICAgICAgICAgIGJvdHRvbU9mZnNldDogKGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgLSB0b3ApIC8gcmVuZGVyU3RhdHVzLnNjYWxlLFxuICAgICAgICAgICAgICAgIGxlZnRPZmZzZXQ6IGxlZnQgLyByZW5kZXJTdGF0dXMuc2NhbGUsXG4gICAgICAgICAgICAgICAgc2NhbGVUbzogcmVuZGVyU3RhdHVzLnNjYWxlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoY3VycmVudE1hdGNoUmVmLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50TWF0Y2hSZWYuY3VycmVudC5jbGFzc0xpc3QucmVtb3ZlKCdycHYtc2VhcmNoX19oaWdobGlnaHQtLWN1cnJlbnQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRNYXRjaFJlZi5jdXJyZW50ID0gaGlnaGxpZ2h0RWxlO1xuICAgICAgICAgICAgaGlnaGxpZ2h0RWxlLmNsYXNzTGlzdC5hZGQoJ3Jwdi1zZWFyY2hfX2hpZ2hsaWdodC0tY3VycmVudCcpO1xuICAgICAgICB9XG4gICAgfSwgW2hpZ2hsaWdodEFyZWFzLCBtYXRjaFBvc2l0aW9uXSk7XG4gICAgUmVhY3RfX25hbWVzcGFjZS51c2VFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICBzdG9yZS5zdWJzY3JpYmUoJ2tleXdvcmQnLCBoYW5kbGVLZXl3b3JkQ2hhbmdlZCk7XG4gICAgICAgIHN0b3JlLnN1YnNjcmliZSgnbWF0Y2hQb3NpdGlvbicsIGhhbmRsZU1hdGNoUG9zaXRpb25DaGFuZ2VkKTtcbiAgICAgICAgc3RvcmUuc3Vic2NyaWJlKCdyZW5kZXJTdGF0dXMnLCBoYW5kbGVSZW5kZXJTdGF0dXNDaGFuZ2VkKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0b3JlLnVuc3Vic2NyaWJlKCdrZXl3b3JkJywgaGFuZGxlS2V5d29yZENoYW5nZWQpO1xuICAgICAgICAgICAgc3RvcmUudW5zdWJzY3JpYmUoJ21hdGNoUG9zaXRpb24nLCBoYW5kbGVNYXRjaFBvc2l0aW9uQ2hhbmdlZCk7XG4gICAgICAgICAgICBzdG9yZS51bnN1YnNjcmliZSgncmVuZGVyU3RhdHVzJywgaGFuZGxlUmVuZGVyU3RhdHVzQ2hhbmdlZCk7XG4gICAgICAgIH07XG4gICAgfSwgW10pO1xuICAgIHJldHVybiAoUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInJwdi1zZWFyY2hfX2hpZ2hsaWdodHNcIiwgXCJkYXRhLXRlc3RpZFwiOiBcInNlYXJjaF9faGlnaGxpZ2h0cy1cIi5jb25jYXQocGFnZUluZGV4KSwgcmVmOiBjb250YWluZXJSZWYgfSwgcmVuZGVySGlnaGxpZ2h0RWxlbWVudHMoe1xuICAgICAgICBnZXRDc3NQcm9wZXJ0aWVzOiBnZXRDc3NQcm9wZXJ0aWVzLFxuICAgICAgICBoaWdobGlnaHRBcmVhczogaGlnaGxpZ2h0QXJlYXMsXG4gICAgfSkpKTtcbn07XG5cbnZhciBlc2NhcGVSZWdFeHAgPSBmdW5jdGlvbiAoaW5wdXQpIHsgcmV0dXJuIGlucHV0LnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCAnXFxcXCQmJyk7IH07XG52YXIgbm9ybWFsaXplRmxhZ0tleXdvcmQgPSBmdW5jdGlvbiAoZmxhZ0tleXdvcmQpIHtcbiAgICB2YXIgc291cmNlID0gZmxhZ0tleXdvcmQud2hvbGVXb3JkcyA/IFwiIFwiLmNvbmNhdChmbGFnS2V5d29yZC5rZXl3b3JkLCBcIiBcIikgOiBmbGFnS2V5d29yZC5rZXl3b3JkO1xuICAgIHZhciBmbGFncyA9IGZsYWdLZXl3b3JkLm1hdGNoQ2FzZSA/ICdnJyA6ICdnaSc7XG4gICAgcmV0dXJuIHtcbiAgICAgICAga2V5d29yZDogZmxhZ0tleXdvcmQua2V5d29yZCxcbiAgICAgICAgcmVnRXhwOiBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4cChzb3VyY2UpLCBmbGFncyksXG4gICAgICAgIHdob2xlV29yZHM6IGZsYWdLZXl3b3JkLndob2xlV29yZHMgfHwgZmFsc2UsXG4gICAgfTtcbn07XG52YXIgbm9ybWFsaXplU2luZ2xlS2V5d29yZCA9IGZ1bmN0aW9uIChrZXl3b3JkLCBtYXRjaENhc2UsIHdob2xlV29yZHMpIHtcbiAgICBpZiAoa2V5d29yZCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5d29yZDoga2V5d29yZC5zb3VyY2UsXG4gICAgICAgICAgICByZWdFeHA6IGtleXdvcmQsXG4gICAgICAgICAgICB3aG9sZVdvcmRzOiB3aG9sZVdvcmRzIHx8IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGtleXdvcmQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBrZXl3b3JkID09PSAnJ1xuICAgICAgICAgICAgPyBFTVBUWV9LRVlXT1JEX1JFR0VYUFxuICAgICAgICAgICAgOiBub3JtYWxpemVGbGFnS2V5d29yZCh7XG4gICAgICAgICAgICAgICAga2V5d29yZDoga2V5d29yZCxcbiAgICAgICAgICAgICAgICBtYXRjaENhc2U6IG1hdGNoQ2FzZSB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aG9sZVdvcmRzOiB3aG9sZVdvcmRzIHx8IGZhbHNlLFxuICAgICAgICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgbWF0Y2hDYXNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBrZXl3b3JkLm1hdGNoQ2FzZSA9IG1hdGNoQ2FzZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB3aG9sZVdvcmRzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBrZXl3b3JkLndob2xlV29yZHMgPSB3aG9sZVdvcmRzO1xuICAgIH1cbiAgICByZXR1cm4gbm9ybWFsaXplRmxhZ0tleXdvcmQoa2V5d29yZCk7XG59O1xuXG52YXIgdXNlRG9jdW1lbnQgPSBmdW5jdGlvbiAoc3RvcmUpIHtcbiAgICB2YXIgY3VycmVudERvY1JlZiA9IFJlYWN0X19uYW1lc3BhY2UudXNlUmVmKHN0b3JlLmdldCgnZG9jJykpO1xuICAgIHZhciBoYW5kbGVEb2N1bWVudENoYW5nZWQgPSBmdW5jdGlvbiAoZG9jKSB7XG4gICAgICAgIGN1cnJlbnREb2NSZWYuY3VycmVudCA9IGRvYztcbiAgICB9O1xuICAgIFJlYWN0X19uYW1lc3BhY2UudXNlRWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RvcmUuc3Vic2NyaWJlKCdkb2MnLCBoYW5kbGVEb2N1bWVudENoYW5nZWQpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RvcmUudW5zdWJzY3JpYmUoJ2RvYycsIGhhbmRsZURvY3VtZW50Q2hhbmdlZCk7XG4gICAgICAgIH07XG4gICAgfSwgW10pO1xuICAgIHJldHVybiBjdXJyZW50RG9jUmVmO1xufTtcblxudmFyIHVzZVNlYXJjaCA9IGZ1bmN0aW9uIChzdG9yZSkge1xuICAgIHZhciBpbml0aWFsS2V5d29yZCA9IHN0b3JlLmdldCgnaW5pdGlhbEtleXdvcmQnKTtcbiAgICB2YXIgbm9ybWFsaXplZEtleXdvcmRGbGFncyA9IFJlYWN0X19uYW1lc3BhY2UudXNlTWVtbyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChpbml0aWFsS2V5d29yZCAmJiBpbml0aWFsS2V5d29yZC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHZhciBub3JtYWxpemVkS2V5d29yZCA9IG5vcm1hbGl6ZVNpbmdsZUtleXdvcmQoaW5pdGlhbEtleXdvcmRbMF0pO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtYXRjaENhc2U6IG5vcm1hbGl6ZWRLZXl3b3JkLnJlZ0V4cC5mbGFncy5pbmRleE9mKCdpJykgPT09IC0xLFxuICAgICAgICAgICAgICAgIHdob2xlV29yZHM6IG5vcm1hbGl6ZWRLZXl3b3JkLndob2xlV29yZHMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtYXRjaENhc2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdob2xlV29yZHM6IGZhbHNlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0sIFtdKTtcbiAgICB2YXIgY3VycmVudERvY1JlZiA9IHVzZURvY3VtZW50KHN0b3JlKTtcbiAgICB2YXIgX2EgPSBSZWFjdF9fbmFtZXNwYWNlLnVzZVN0YXRlKGluaXRpYWxLZXl3b3JkKSwga2V5d29yZHMgPSBfYVswXSwgc2V0S2V5d29yZHMgPSBfYVsxXTtcbiAgICB2YXIgX2IgPSBSZWFjdF9fbmFtZXNwYWNlLnVzZVN0YXRlKFtdKSwgZm91bmQgPSBfYlswXSwgc2V0Rm91bmQgPSBfYlsxXTtcbiAgICB2YXIgX2MgPSBSZWFjdF9fbmFtZXNwYWNlLnVzZVN0YXRlKDApLCBjdXJyZW50TWF0Y2ggPSBfY1swXSwgc2V0Q3VycmVudE1hdGNoID0gX2NbMV07XG4gICAgdmFyIF9kID0gUmVhY3RfX25hbWVzcGFjZS51c2VTdGF0ZShub3JtYWxpemVkS2V5d29yZEZsYWdzLm1hdGNoQ2FzZSksIG1hdGNoQ2FzZSA9IF9kWzBdLCBzZXRNYXRjaENhc2UgPSBfZFsxXTtcbiAgICB2YXIgdGV4dENvbnRlbnRzID0gUmVhY3RfX25hbWVzcGFjZS51c2VSZWYoW10pO1xuICAgIHZhciBfZSA9IFJlYWN0X19uYW1lc3BhY2UudXNlU3RhdGUobm9ybWFsaXplZEtleXdvcmRGbGFncy53aG9sZVdvcmRzKSwgd2hvbGVXb3JkcyA9IF9lWzBdLCBzZXRXaG9sZVdvcmRzID0gX2VbMV07XG4gICAgdmFyIGRlZmF1bHRUYXJnZXRQYWdlRmlsdGVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJ1ZTsgfTtcbiAgICB2YXIgdGFyZ2V0UGFnZUZpbHRlciA9IFJlYWN0X19uYW1lc3BhY2UudXNlQ2FsbGJhY2soZnVuY3Rpb24gKCkgeyByZXR1cm4gc3RvcmUuZ2V0KCd0YXJnZXRQYWdlRmlsdGVyJykgfHwgZGVmYXVsdFRhcmdldFBhZ2VGaWx0ZXI7IH0sIFtzdG9yZS5nZXQoJ3RhcmdldFBhZ2VGaWx0ZXInKV0pO1xuICAgIHZhciBjaGFuZ2VNYXRjaENhc2UgPSBmdW5jdGlvbiAoaXNDaGVja2VkKSB7XG4gICAgICAgIHNldE1hdGNoQ2FzZShpc0NoZWNrZWQpO1xuICAgICAgICBpZiAoa2V5d29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc2VhcmNoRm9yKGtleXdvcmRzLCBpc0NoZWNrZWQsIHdob2xlV29yZHMpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgY2hhbmdlV2hvbGVXb3JkcyA9IGZ1bmN0aW9uIChpc0NoZWNrZWQpIHtcbiAgICAgICAgc2V0V2hvbGVXb3Jkcyhpc0NoZWNrZWQpO1xuICAgICAgICBpZiAoa2V5d29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc2VhcmNoRm9yKGtleXdvcmRzLCBtYXRjaENhc2UsIGlzQ2hlY2tlZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHZhciBqdW1wVG9NYXRjaCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICB2YXIgbnVtTWF0Y2hlcyA9IGZvdW5kLmxlbmd0aDtcbiAgICAgICAgaWYgKGtleXdvcmRzLmxlbmd0aCA9PT0gMCB8fCBudW1NYXRjaGVzID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbm9ybWFsaXplZEluZGV4ID0gaW5kZXggPT09IG51bU1hdGNoZXMgKyAxID8gMSA6IE1hdGgubWF4KDEsIE1hdGgubWluKG51bU1hdGNoZXMsIGluZGV4KSk7XG4gICAgICAgIHNldEN1cnJlbnRNYXRjaChub3JtYWxpemVkSW5kZXgpO1xuICAgICAgICByZXR1cm4ganVtcFRvR2l2ZW5NYXRjaChmb3VuZFtub3JtYWxpemVkSW5kZXggLSAxXSk7XG4gICAgfTtcbiAgICB2YXIganVtcFRvUHJldmlvdXNNYXRjaCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGp1bXBUb01hdGNoKGN1cnJlbnRNYXRjaCAtIDEpOyB9O1xuICAgIHZhciBqdW1wVG9OZXh0TWF0Y2ggPSBmdW5jdGlvbiAoKSB7IHJldHVybiBqdW1wVG9NYXRjaChjdXJyZW50TWF0Y2ggKyAxKTsgfTtcbiAgICB2YXIgY2xlYXJLZXl3b3JkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzdG9yZS51cGRhdGUoJ2tleXdvcmQnLCBbRU1QVFlfS0VZV09SRF9SRUdFWFBdKTtcbiAgICAgICAgc2V0S2V5d29yZCgnJyk7XG4gICAgICAgIHNldEN1cnJlbnRNYXRjaCgwKTtcbiAgICAgICAgc2V0Rm91bmQoW10pO1xuICAgICAgICBzZXRNYXRjaENhc2UoZmFsc2UpO1xuICAgICAgICBzZXRXaG9sZVdvcmRzKGZhbHNlKTtcbiAgICB9O1xuICAgIHZhciBzZWFyY2ggPSBmdW5jdGlvbiAoKSB7IHJldHVybiBzZWFyY2hGb3Ioa2V5d29yZHMsIG1hdGNoQ2FzZSwgd2hvbGVXb3Jkcyk7IH07XG4gICAgdmFyIHNldEtleXdvcmQgPSBmdW5jdGlvbiAoa2V5d29yZCkgeyByZXR1cm4gc2V0S2V5d29yZHMoa2V5d29yZCA9PT0gJycgPyBbXSA6IFtrZXl3b3JkXSk7IH07XG4gICAgdmFyIHNldFRhcmdldFBhZ2VzID0gZnVuY3Rpb24gKHRhcmdldFBhZ2VGaWx0ZXIpIHtcbiAgICAgICAgc3RvcmUudXBkYXRlKCd0YXJnZXRQYWdlRmlsdGVyJywgdGFyZ2V0UGFnZUZpbHRlcik7XG4gICAgfTtcbiAgICB2YXIgZ2V0VGV4dENvbnRlbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3VycmVudERvYyA9IGN1cnJlbnREb2NSZWYuY3VycmVudDtcbiAgICAgICAgaWYgKCFjdXJyZW50RG9jKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcHJvbWlzZXMgPSBBcnJheShjdXJyZW50RG9jLm51bVBhZ2VzKVxuICAgICAgICAgICAgLmZpbGwoMClcbiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKF8sIHBhZ2VJbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvcmUuZ2V0UGFnZShjdXJyZW50RG9jLCBwYWdlSW5kZXgpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFnZS5nZXRUZXh0Q29udGVudCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgICAgICAgICAgIHZhciBwYWdlQ29udGVudCA9IGNvbnRlbnQuaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7IHJldHVybiBpdGVtLnN0ciB8fCAnJzsgfSkuam9pbignJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VDb250ZW50OiBwYWdlQ29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4OiBwYWdlSW5kZXgsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgZGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhLnBhZ2VJbmRleCAtIGIucGFnZUluZGV4OyB9KTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZGF0YS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0ucGFnZUNvbnRlbnQ7IH0pKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIganVtcFRvR2l2ZW5NYXRjaCA9IGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICB2YXIganVtcFRvUGFnZSA9IHN0b3JlLmdldCgnanVtcFRvUGFnZScpO1xuICAgICAgICBpZiAoanVtcFRvUGFnZSkge1xuICAgICAgICAgICAganVtcFRvUGFnZShtYXRjaC5wYWdlSW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlLnVwZGF0ZSgnbWF0Y2hQb3NpdGlvbicsIHtcbiAgICAgICAgICAgIG1hdGNoSW5kZXg6IG1hdGNoLm1hdGNoSW5kZXgsXG4gICAgICAgICAgICBwYWdlSW5kZXg6IG1hdGNoLnBhZ2VJbmRleCxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBtYXRjaDtcbiAgICB9O1xuICAgIHZhciBnZXRLZXl3b3JkU291cmNlID0gZnVuY3Rpb24gKGtleXdvcmQpIHtcbiAgICAgICAgaWYgKGtleXdvcmQgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgICAgICAgIHJldHVybiBrZXl3b3JkLnNvdXJjZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGtleXdvcmQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4ga2V5d29yZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ga2V5d29yZC5rZXl3b3JkO1xuICAgIH07XG4gICAgdmFyIHNlYXJjaEZvciA9IGZ1bmN0aW9uIChrZXl3b3JkUGFyYW0sIG1hdGNoQ2FzZVBhcmFtLCB3aG9sZVdvcmRzUGFyYW0pIHtcbiAgICAgICAgdmFyIGN1cnJlbnREb2MgPSBjdXJyZW50RG9jUmVmLmN1cnJlbnQ7XG4gICAgICAgIGlmICghY3VycmVudERvYykge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG51bVBhZ2VzID0gY3VycmVudERvYy5udW1QYWdlcztcbiAgICAgICAgdmFyIGtleXdvcmRzID0ga2V5d29yZFBhcmFtLm1hcChmdW5jdGlvbiAoaykgeyByZXR1cm4gbm9ybWFsaXplU2luZ2xlS2V5d29yZChrLCBtYXRjaENhc2VQYXJhbSwgd2hvbGVXb3Jkc1BhcmFtKTsgfSk7XG4gICAgICAgIHN0b3JlLnVwZGF0ZSgna2V5d29yZCcsIGtleXdvcmRzKTtcbiAgICAgICAgc2V0Q3VycmVudE1hdGNoKDApO1xuICAgICAgICBzZXRGb3VuZChbXSk7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgXykge1xuICAgICAgICAgICAgdmFyIGdldFRleHRQcm9taXNlID0gdGV4dENvbnRlbnRzLmN1cnJlbnQubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICAgPyBnZXRUZXh0Q29udGVudHMoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0Q29udGVudHMuY3VycmVudCA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIDogUHJvbWlzZS5yZXNvbHZlKHRleHRDb250ZW50cy5jdXJyZW50KTtcbiAgICAgICAgICAgIGdldFRleHRQcm9taXNlLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24gKHBhZ2VUZXh0LCBwYWdlSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFBhZ2VGaWx0ZXIoKSh7IHBhZ2VJbmRleDogcGFnZUluZGV4LCBudW1QYWdlczogbnVtUGFnZXMgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXdvcmRzLmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hJbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChtYXRjaGVzID0ga2V5d29yZC5yZWdFeHAuZXhlYyhwYWdlVGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXdvcmQ6IGtleXdvcmQucmVnRXhwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hJbmRleDogbWF0Y2hJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogcGFnZUluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVRleHQ6IHBhZ2VUZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleDogbWF0Y2hlcy5pbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZEluZGV4OiBrZXl3b3JkLnJlZ0V4cC5sYXN0SW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZXRGb3VuZChhcnIpO1xuICAgICAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRDdXJyZW50TWF0Y2goMSk7XG4gICAgICAgICAgICAgICAgICAgIGp1bXBUb0dpdmVuTWF0Y2goYXJyWzBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUmVhY3RfX25hbWVzcGFjZS51c2VFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICB0ZXh0Q29udGVudHMuY3VycmVudCA9IFtdO1xuICAgIH0sIFtjdXJyZW50RG9jUmVmLmN1cnJlbnRdKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBjbGVhcktleXdvcmQ6IGNsZWFyS2V5d29yZCxcbiAgICAgICAgY2hhbmdlTWF0Y2hDYXNlOiBjaGFuZ2VNYXRjaENhc2UsXG4gICAgICAgIGNoYW5nZVdob2xlV29yZHM6IGNoYW5nZVdob2xlV29yZHMsXG4gICAgICAgIGN1cnJlbnRNYXRjaDogY3VycmVudE1hdGNoLFxuICAgICAgICBqdW1wVG9NYXRjaDoganVtcFRvTWF0Y2gsXG4gICAgICAgIGp1bXBUb05leHRNYXRjaDoganVtcFRvTmV4dE1hdGNoLFxuICAgICAgICBqdW1wVG9QcmV2aW91c01hdGNoOiBqdW1wVG9QcmV2aW91c01hdGNoLFxuICAgICAgICBrZXl3b3Jkczoga2V5d29yZHMsXG4gICAgICAgIG1hdGNoQ2FzZTogbWF0Y2hDYXNlLFxuICAgICAgICBudW1iZXJPZk1hdGNoZXM6IGZvdW5kLmxlbmd0aCxcbiAgICAgICAgd2hvbGVXb3Jkczogd2hvbGVXb3JkcyxcbiAgICAgICAgc2VhcmNoOiBzZWFyY2gsXG4gICAgICAgIHNlYXJjaEZvcjogc2VhcmNoRm9yLFxuICAgICAgICBzZXRLZXl3b3Jkczogc2V0S2V5d29yZHMsXG4gICAgICAgIGtleXdvcmQ6IGtleXdvcmRzLmxlbmd0aCA9PT0gMCA/ICcnIDogZ2V0S2V5d29yZFNvdXJjZShrZXl3b3Jkc1swXSksXG4gICAgICAgIHNldEtleXdvcmQ6IHNldEtleXdvcmQsXG4gICAgICAgIHNldFRhcmdldFBhZ2VzOiBzZXRUYXJnZXRQYWdlcyxcbiAgICB9O1xufTtcblxudmFyIFNlYXJjaCA9IGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBjaGlsZHJlbiA9IF9hLmNoaWxkcmVuLCBzdG9yZSA9IF9hLnN0b3JlO1xuICAgIHZhciByZXN1bHQgPSB1c2VTZWFyY2goc3RvcmUpO1xuICAgIHZhciBfYiA9IFJlYWN0X19uYW1lc3BhY2UudXNlU3RhdGUoZmFsc2UpLCBpc0RvY3VtZW50TG9hZGVkID0gX2JbMF0sIHNldERvY3VtZW50TG9hZGVkID0gX2JbMV07XG4gICAgdmFyIGhhbmRsZURvY3VtZW50Q2hhbmdlZCA9IGZ1bmN0aW9uIChfKSB7IHJldHVybiBzZXREb2N1bWVudExvYWRlZCh0cnVlKTsgfTtcbiAgICBSZWFjdF9fbmFtZXNwYWNlLnVzZUVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN0b3JlLnN1YnNjcmliZSgnZG9jJywgaGFuZGxlRG9jdW1lbnRDaGFuZ2VkKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0b3JlLnVuc3Vic2NyaWJlKCdkb2MnLCBoYW5kbGVEb2N1bWVudENoYW5nZWQpO1xuICAgICAgICB9O1xuICAgIH0sIFtdKTtcbiAgICByZXR1cm4gY2hpbGRyZW4oX19hc3NpZ24oX19hc3NpZ24oe30sIHJlc3VsdCksIHsgaXNEb2N1bWVudExvYWRlZDogaXNEb2N1bWVudExvYWRlZCB9KSk7XG59O1xuXG52YXIgU2hvcnRjdXRIYW5kbGVyID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIGNvbnRhaW5lclJlZiA9IF9hLmNvbnRhaW5lclJlZiwgc3RvcmUgPSBfYS5zdG9yZTtcbiAgICB2YXIgaXNNb3VzZUluc2lkZVJlZiA9IFJlYWN0X19uYW1lc3BhY2UudXNlUmVmKGZhbHNlKTtcbiAgICB2YXIgaGFuZGxlTW91c2VFbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXNNb3VzZUluc2lkZVJlZi5jdXJyZW50ID0gdHJ1ZTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVNb3VzZUxlYXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpc01vdXNlSW5zaWRlUmVmLmN1cnJlbnQgPSBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVLZXlkb3duID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGNvbnRhaW5lckVsZSA9IGNvbnRhaW5lclJlZi5jdXJyZW50O1xuICAgICAgICBpZiAoIWNvbnRhaW5lckVsZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnNoaWZ0S2V5IHx8IGUuYWx0S2V5IHx8IGUua2V5ICE9PSAnZicpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaXNDb21tYW5kUHJlc3NlZCA9IGNvcmUuaXNNYWMoKSA/IGUubWV0YUtleSAmJiAhZS5jdHJsS2V5IDogZS5jdHJsS2V5O1xuICAgICAgICBpZiAoIWlzQ29tbWFuZFByZXNzZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNNb3VzZUluc2lkZVJlZi5jdXJyZW50IHx8IChkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIGNvbnRhaW5lckVsZS5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN0b3JlLnVwZGF0ZSgnYXJlU2hvcnRjdXRzUHJlc3NlZCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBSZWFjdF9fbmFtZXNwYWNlLnVzZUVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb250YWluZXJFbGUgPSBjb250YWluZXJSZWYuY3VycmVudDtcbiAgICAgICAgaWYgKCFjb250YWluZXJFbGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5ZG93bik7XG4gICAgICAgIGNvbnRhaW5lckVsZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgaGFuZGxlTW91c2VFbnRlcik7XG4gICAgICAgIGNvbnRhaW5lckVsZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgaGFuZGxlTW91c2VMZWF2ZSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5ZG93bik7XG4gICAgICAgICAgICBjb250YWluZXJFbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIGhhbmRsZU1vdXNlRW50ZXIpO1xuICAgICAgICAgICAgY29udGFpbmVyRWxlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBoYW5kbGVNb3VzZUxlYXZlKTtcbiAgICAgICAgfTtcbiAgICB9LCBbY29udGFpbmVyUmVmLmN1cnJlbnRdKTtcbiAgICByZXR1cm4gUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFJlYWN0X19uYW1lc3BhY2UuRnJhZ21lbnQsIG51bGwpO1xufTtcblxudmFyIFBPUlRBTF9PRkZTRVQkMSA9IHsgbGVmdDogMCwgdG9wOiA4IH07XG52YXIgU2VhcmNoUG9wb3ZlciA9IGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBzdG9yZSA9IF9hLnN0b3JlLCBvblRvZ2dsZSA9IF9hLm9uVG9nZ2xlO1xuICAgIHZhciBsMTBuID0gUmVhY3RfX25hbWVzcGFjZS51c2VDb250ZXh0KGNvcmUuTG9jYWxpemF0aW9uQ29udGV4dCkubDEwbjtcbiAgICB2YXIgZGlyZWN0aW9uID0gUmVhY3RfX25hbWVzcGFjZS51c2VDb250ZXh0KGNvcmUuVGhlbWVDb250ZXh0KS5kaXJlY3Rpb247XG4gICAgdmFyIF9iID0gUmVhY3RfX25hbWVzcGFjZS51c2VTdGF0ZShmYWxzZSksIGlzUXVlcnlpbmcgPSBfYlswXSwgc2V0SXNRdWVyeWluZyA9IF9iWzFdO1xuICAgIHZhciBfYyA9IFJlYWN0X19uYW1lc3BhY2UudXNlU3RhdGUoZmFsc2UpLCBzZWFyY2hEb25lID0gX2NbMF0sIHNldFNlYXJjaERvbmUgPSBfY1sxXTtcbiAgICB2YXIgaXNSdGwgPSBkaXJlY3Rpb24gPT09IGNvcmUuVGV4dERpcmVjdGlvbi5SaWdodFRvTGVmdDtcbiAgICB2YXIgX2QgPSB1c2VTZWFyY2goc3RvcmUpLCBjbGVhcktleXdvcmQgPSBfZC5jbGVhcktleXdvcmQsIGNoYW5nZU1hdGNoQ2FzZSA9IF9kLmNoYW5nZU1hdGNoQ2FzZSwgY2hhbmdlV2hvbGVXb3JkcyA9IF9kLmNoYW5nZVdob2xlV29yZHMsIGN1cnJlbnRNYXRjaCA9IF9kLmN1cnJlbnRNYXRjaCwganVtcFRvTmV4dE1hdGNoID0gX2QuanVtcFRvTmV4dE1hdGNoLCBqdW1wVG9QcmV2aW91c01hdGNoID0gX2QuanVtcFRvUHJldmlvdXNNYXRjaCwga2V5d29yZCA9IF9kLmtleXdvcmQsIG1hdGNoQ2FzZSA9IF9kLm1hdGNoQ2FzZSwgbnVtYmVyT2ZNYXRjaGVzID0gX2QubnVtYmVyT2ZNYXRjaGVzLCB3aG9sZVdvcmRzID0gX2Qud2hvbGVXb3Jkcywgc2VhcmNoID0gX2Quc2VhcmNoLCBzZXRLZXl3b3JkID0gX2Quc2V0S2V5d29yZDtcbiAgICB2YXIgcGVyZm9ybVNlYXJjaCA9IGZ1bmN0aW9uIChjYikge1xuICAgICAgICBzZXRJc1F1ZXJ5aW5nKHRydWUpO1xuICAgICAgICBzZWFyY2goKS50aGVuKGZ1bmN0aW9uIChfKSB7XG4gICAgICAgICAgICBzZXRJc1F1ZXJ5aW5nKGZhbHNlKTtcbiAgICAgICAgICAgIHNldFNlYXJjaERvbmUodHJ1ZSk7XG4gICAgICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvbktleWRvd25TZWFyY2ggPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYga2V5d29yZCkge1xuICAgICAgICAgICAgc2VhcmNoRG9uZSA/IGp1bXBUb05leHRNYXRjaCgpIDogcGVyZm9ybVNlYXJjaCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgb25DaGFuZ2VNYXRjaENhc2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBzZXRTZWFyY2hEb25lKGZhbHNlKTtcbiAgICAgICAgY2hhbmdlTWF0Y2hDYXNlKGUudGFyZ2V0LmNoZWNrZWQpO1xuICAgIH07XG4gICAgdmFyIG9uQ2hhbmdlV2hvbGVXb3JkcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHNldFNlYXJjaERvbmUoZmFsc2UpO1xuICAgICAgICBjaGFuZ2VXaG9sZVdvcmRzKGUudGFyZ2V0LmNoZWNrZWQpO1xuICAgIH07XG4gICAgdmFyIG9uQ2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG9uVG9nZ2xlKCk7XG4gICAgICAgIGNsZWFyS2V5d29yZCgpO1xuICAgIH07XG4gICAgdmFyIG9uQ2hhbmdlS2V5d29yZCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBzZXRTZWFyY2hEb25lKGZhbHNlKTtcbiAgICAgICAgc2V0S2V5d29yZCh2YWx1ZSk7XG4gICAgfTtcbiAgICBSZWFjdF9fbmFtZXNwYWNlLnVzZUVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpbml0aWFsS2V5d29yZCA9IHN0b3JlLmdldCgnaW5pdGlhbEtleXdvcmQnKTtcbiAgICAgICAgaWYgKGluaXRpYWxLZXl3b3JkICYmIGluaXRpYWxLZXl3b3JkLmxlbmd0aCA9PT0gMSAmJiBrZXl3b3JkKSB7XG4gICAgICAgICAgICBwZXJmb3JtU2VhcmNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzdG9yZS51cGRhdGUoJ2luaXRpYWxLZXl3b3JkJywgW10pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LCBbXSk7XG4gICAgdmFyIHNlYXJjaExhYmVsID0gbDEwbiAmJiBsMTBuLnNlYXJjaCA/IGwxMG4uc2VhcmNoLmVudGVyVG9TZWFyY2ggOiAnRW50ZXIgdG8gc2VhcmNoJztcbiAgICB2YXIgcHJldmlvdXNNYXRjaExhYmVsID0gbDEwbiAmJiBsMTBuLnNlYXJjaCA/IGwxMG4uc2VhcmNoLnByZXZpb3VzTWF0Y2ggOiAnUHJldmlvdXMgbWF0Y2gnO1xuICAgIHZhciBuZXh0TWF0Y2hMYWJlbCA9IGwxMG4gJiYgbDEwbi5zZWFyY2ggPyBsMTBuLnNlYXJjaC5uZXh0TWF0Y2ggOiAnTmV4dCBtYXRjaCc7XG4gICAgdmFyIGNsb3NlQnV0dG9uTGFiZWwgPSBsMTBuICYmIGwxMG4uc2VhcmNoID8gbDEwbi5zZWFyY2guY2xvc2UgOiAnQ2xvc2UnO1xuICAgIHJldHVybiAoUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInJwdi1zZWFyY2hfX3BvcG92ZXJcIiB9LFxuICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicnB2LXNlYXJjaF9fcG9wb3Zlci1pbnB1dC1jb3VudGVyXCIgfSxcbiAgICAgICAgICAgIFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChjb3JlLlRleHRCb3gsIHsgYXJpYUxhYmVsOiBzZWFyY2hMYWJlbCwgYXV0b0ZvY3VzOiB0cnVlLCBwbGFjZWhvbGRlcjogc2VhcmNoTGFiZWwsIHR5cGU6IFwidGV4dFwiLCB2YWx1ZToga2V5d29yZCwgb25DaGFuZ2U6IG9uQ2hhbmdlS2V5d29yZCwgb25LZXlEb3duOiBvbktleWRvd25TZWFyY2ggfSksXG4gICAgICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IGNvcmUuY2xhc3NOYW1lcyh7XG4gICAgICAgICAgICAgICAgICAgICdycHYtc2VhcmNoX19wb3BvdmVyLWNvdW50ZXInOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAncnB2LXNlYXJjaF9fcG9wb3Zlci1jb3VudGVyLS1sdHInOiAhaXNSdGwsXG4gICAgICAgICAgICAgICAgICAgICdycHYtc2VhcmNoX19wb3BvdmVyLWNvdW50ZXItLXJ0bCc6IGlzUnRsLFxuICAgICAgICAgICAgICAgIH0pIH0sXG4gICAgICAgICAgICAgICAgaXNRdWVyeWluZyAmJiBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoY29yZS5TcGlubmVyLCB7IHRlc3RJZDogXCJzZWFyY2hfX3BvcG92ZXItc2VhcmNoaW5nXCIsIHNpemU6IFwiMXJlbVwiIH0pLFxuICAgICAgICAgICAgICAgICFpc1F1ZXJ5aW5nICYmIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgXCJkYXRhLXRlc3RpZFwiOiBcInNlYXJjaF9fcG9wb3Zlci1udW0tbWF0Y2hlc1wiIH0sXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNYXRjaCxcbiAgICAgICAgICAgICAgICAgICAgXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIG51bWJlck9mTWF0Y2hlcykpKSksXG4gICAgICAgIFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBcInJwdi1zZWFyY2hfX3BvcG92ZXItbGFiZWxcIiB9LFxuICAgICAgICAgICAgUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyBjbGFzc05hbWU6IFwicnB2LXNlYXJjaF9fcG9wb3Zlci1sYWJlbC1jaGVja2JveFwiLCBcImRhdGEtdGVzdGlkXCI6IFwic2VhcmNoX19wb3BvdmVyLW1hdGNoLWNhc2VcIiwgY2hlY2tlZDogbWF0Y2hDYXNlLCB0eXBlOiBcImNoZWNrYm94XCIsIG9uQ2hhbmdlOiBvbkNoYW5nZU1hdGNoQ2FzZSB9KSxcbiAgICAgICAgICAgICcgJyxcbiAgICAgICAgICAgIGwxMG4gJiYgbDEwbi5zZWFyY2ggPyBsMTBuLnNlYXJjaC5tYXRjaENhc2UgOiAnTWF0Y2ggY2FzZScpLFxuICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiLCB7IGNsYXNzTmFtZTogXCJycHYtc2VhcmNoX19wb3BvdmVyLWxhYmVsXCIgfSxcbiAgICAgICAgICAgIFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIHsgY2xhc3NOYW1lOiBcInJwdi1zZWFyY2hfX3BvcG92ZXItbGFiZWwtY2hlY2tib3hcIiwgY2hlY2tlZDogd2hvbGVXb3JkcywgXCJkYXRhLXRlc3RpZFwiOiBcInNlYXJjaF9fcG9wb3Zlci13aG9sZS13b3Jkc1wiLCB0eXBlOiBcImNoZWNrYm94XCIsIG9uQ2hhbmdlOiBvbkNoYW5nZVdob2xlV29yZHMgfSksXG4gICAgICAgICAgICAnICcsXG4gICAgICAgICAgICBsMTBuICYmIGwxMG4uc2VhcmNoID8gbDEwbi5zZWFyY2gud2hvbGVXb3JkcyA6ICdXaG9sZSB3b3JkcycpLFxuICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicnB2LXNlYXJjaF9fcG9wb3Zlci1mb290ZXJcIiB9LFxuICAgICAgICAgICAgUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInJwdi1zZWFyY2hfX3BvcG92ZXItZm9vdGVyLWl0ZW1cIiB9LFxuICAgICAgICAgICAgICAgIFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChjb3JlLlRvb2x0aXAsIHsgYXJpYUNvbnRyb2xzU3VmZml4OiBcInNlYXJjaC1wcmV2aW91cy1tYXRjaFwiLCBwb3NpdGlvbjogaXNSdGwgPyBjb3JlLlBvc2l0aW9uLkJvdHRvbVJpZ2h0IDogY29yZS5Qb3NpdGlvbi5Cb3R0b21DZW50ZXIsIHRhcmdldDogUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KGNvcmUuTWluaW1hbEJ1dHRvbiwgeyBhcmlhTGFiZWw6IHByZXZpb3VzTWF0Y2hMYWJlbCwgaXNEaXNhYmxlZDogY3VycmVudE1hdGNoIDw9IDEsIG9uQ2xpY2s6IGp1bXBUb1ByZXZpb3VzTWF0Y2ggfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChQcmV2aW91c0ljb24sIG51bGwpKSwgY29udGVudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcHJldmlvdXNNYXRjaExhYmVsOyB9LCBvZmZzZXQ6IFBPUlRBTF9PRkZTRVQkMSB9KSksXG4gICAgICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwicnB2LXNlYXJjaF9fcG9wb3Zlci1mb290ZXItaXRlbVwiIH0sXG4gICAgICAgICAgICAgICAgUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KGNvcmUuVG9vbHRpcCwgeyBhcmlhQ29udHJvbHNTdWZmaXg6IFwic2VhcmNoLW5leHQtbWF0Y2hcIiwgcG9zaXRpb246IGNvcmUuUG9zaXRpb24uQm90dG9tQ2VudGVyLCB0YXJnZXQ6IFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChjb3JlLk1pbmltYWxCdXR0b24sIHsgYXJpYUxhYmVsOiBuZXh0TWF0Y2hMYWJlbCwgaXNEaXNhYmxlZDogY3VycmVudE1hdGNoID4gbnVtYmVyT2ZNYXRjaGVzIC0gMSwgb25DbGljazoganVtcFRvTmV4dE1hdGNoIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoTmV4dEljb24sIG51bGwpKSwgY29udGVudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV4dE1hdGNoTGFiZWw7IH0sIG9mZnNldDogUE9SVEFMX09GRlNFVCQxIH0pKSxcbiAgICAgICAgICAgIFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogY29yZS5jbGFzc05hbWVzKHtcbiAgICAgICAgICAgICAgICAgICAgJ3Jwdi1zZWFyY2hfX3BvcG92ZXItZm9vdGVyLWJ1dHRvbic6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICdycHYtc2VhcmNoX19wb3BvdmVyLWZvb3Rlci1idXR0b24tLWx0cic6ICFpc1J0bCxcbiAgICAgICAgICAgICAgICAgICAgJ3Jwdi1zZWFyY2hfX3BvcG92ZXItZm9vdGVyLWJ1dHRvbi0tcnRsJzogaXNSdGwsXG4gICAgICAgICAgICAgICAgfSkgfSxcbiAgICAgICAgICAgICAgICBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoY29yZS5CdXR0b24sIHsgb25DbGljazogb25DbG9zZSB9LCBjbG9zZUJ1dHRvbkxhYmVsKSkpKSk7XG59O1xuXG52YXIgU2hvd1NlYXJjaFBvcG92ZXJEZWNvcmF0b3IgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICB2YXIgY2hpbGRyZW4gPSBfYS5jaGlsZHJlbiwgb25DbGljayA9IF9hLm9uQ2xpY2s7XG4gICAgdmFyIGwxMG4gPSBSZWFjdF9fbmFtZXNwYWNlLnVzZUNvbnRleHQoY29yZS5Mb2NhbGl6YXRpb25Db250ZXh0KS5sMTBuO1xuICAgIHZhciBsYWJlbCA9IGwxMG4gJiYgbDEwbi5zZWFyY2ggPyBsMTBuLnNlYXJjaC5zZWFyY2ggOiAnU2VhcmNoJztcbiAgICB2YXIgaWNvbiA9IFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChTZWFyY2hJY29uLCBudWxsKTtcbiAgICByZXR1cm4gY2hpbGRyZW4oeyBpY29uOiBpY29uLCBsYWJlbDogbGFiZWwsIG9uQ2xpY2s6IG9uQ2xpY2sgfSk7XG59O1xuXG52YXIgVE9PTFRJUF9PRkZTRVQgPSB7IGxlZnQ6IDAsIHRvcDogOCB9O1xudmFyIFNob3dTZWFyY2hQb3BvdmVyQnV0dG9uID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIGVuYWJsZVNob3J0Y3V0cyA9IF9hLmVuYWJsZVNob3J0Y3V0cywgc3RvcmUgPSBfYS5zdG9yZSwgb25DbGljayA9IF9hLm9uQ2xpY2s7XG4gICAgdmFyIGFyaWFLZXlTaG9ydGN1dHMgPSBlbmFibGVTaG9ydGN1dHMgPyAoY29yZS5pc01hYygpID8gJ01ldGErRicgOiAnQ3RybCtGJykgOiAnJztcbiAgICB2YXIgaGFuZGxlU2hvcnRjdXRzUHJlc3NlZCA9IGZ1bmN0aW9uIChhcmVTaG9ydGN1dHNQcmVzc2VkKSB7XG4gICAgICAgIGlmIChhcmVTaG9ydGN1dHNQcmVzc2VkKSB7XG4gICAgICAgICAgICBvbkNsaWNrKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFJlYWN0X19uYW1lc3BhY2UudXNlRWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RvcmUuc3Vic2NyaWJlKCdhcmVTaG9ydGN1dHNQcmVzc2VkJywgaGFuZGxlU2hvcnRjdXRzUHJlc3NlZCk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdG9yZS51bnN1YnNjcmliZSgnYXJlU2hvcnRjdXRzUHJlc3NlZCcsIGhhbmRsZVNob3J0Y3V0c1ByZXNzZWQpO1xuICAgICAgICB9O1xuICAgIH0sIFtdKTtcbiAgICByZXR1cm4gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChTaG93U2VhcmNoUG9wb3ZlckRlY29yYXRvciwgeyBvbkNsaWNrOiBvbkNsaWNrIH0sIGZ1bmN0aW9uIChwKSB7IHJldHVybiAoUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KGNvcmUuVG9vbHRpcCwgeyBhcmlhQ29udHJvbHNTdWZmaXg6IFwic2VhcmNoLXBvcG92ZXJcIiwgcG9zaXRpb246IGNvcmUuUG9zaXRpb24uQm90dG9tQ2VudGVyLCB0YXJnZXQ6IFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChjb3JlLk1pbmltYWxCdXR0b24sIHsgYXJpYUtleVNob3J0Y3V0czogYXJpYUtleVNob3J0Y3V0cywgYXJpYUxhYmVsOiBwLmxhYmVsLCB0ZXN0SWQ6IFwic2VhcmNoX19wb3BvdmVyLWJ1dHRvblwiLCBvbkNsaWNrOiBvbkNsaWNrIH0sIHAuaWNvbiksIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHAubGFiZWw7IH0sIG9mZnNldDogVE9PTFRJUF9PRkZTRVQgfSkpOyB9KSk7XG59O1xuXG52YXIgUE9SVEFMX09GRlNFVCA9IHsgbGVmdDogMCwgdG9wOiA4IH07XG52YXIgU2hvd1NlYXJjaFBvcG92ZXIgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICB2YXIgY2hpbGRyZW4gPSBfYS5jaGlsZHJlbiwgZW5hYmxlU2hvcnRjdXRzID0gX2EuZW5hYmxlU2hvcnRjdXRzLCBzdG9yZSA9IF9hLnN0b3JlO1xuICAgIHZhciBkaXJlY3Rpb24gPSBSZWFjdF9fbmFtZXNwYWNlLnVzZUNvbnRleHQoY29yZS5UaGVtZUNvbnRleHQpLmRpcmVjdGlvbjtcbiAgICB2YXIgcG9ydGFsUG9zaXRpb24gPSBkaXJlY3Rpb24gPT09IGNvcmUuVGV4dERpcmVjdGlvbi5SaWdodFRvTGVmdCA/IGNvcmUuUG9zaXRpb24uQm90dG9tUmlnaHQgOiBjb3JlLlBvc2l0aW9uLkJvdHRvbUxlZnQ7XG4gICAgdmFyIGRlZmF1bHRDaGlsZHJlbiA9IGZ1bmN0aW9uIChwcm9wcykgeyByZXR1cm4gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChTaG93U2VhcmNoUG9wb3ZlckJ1dHRvbiwgX19hc3NpZ24oeyBlbmFibGVTaG9ydGN1dHM6IGVuYWJsZVNob3J0Y3V0cywgc3RvcmU6IHN0b3JlIH0sIHByb3BzKSkpOyB9O1xuICAgIHZhciByZW5kZXIgPSBjaGlsZHJlbiB8fCBkZWZhdWx0Q2hpbGRyZW47XG4gICAgcmV0dXJuIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoY29yZS5Qb3BvdmVyLCB7IGFyaWFDb250cm9sc1N1ZmZpeDogXCJzZWFyY2hcIiwgbG9ja1Njcm9sbDogZmFsc2UsIHBvc2l0aW9uOiBwb3J0YWxQb3NpdGlvbiwgdGFyZ2V0OiBmdW5jdGlvbiAodG9nZ2xlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyKHtcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiB0b2dnbGUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgY29udGVudDogZnVuY3Rpb24gKHRvZ2dsZSkgeyByZXR1cm4gUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFNlYXJjaFBvcG92ZXIsIHsgc3RvcmU6IHN0b3JlLCBvblRvZ2dsZTogdG9nZ2xlIH0pOyB9LCBvZmZzZXQ6IFBPUlRBTF9PRkZTRVQsIGNsb3NlT25DbGlja091dHNpZGU6IGZhbHNlLCBjbG9zZU9uRXNjYXBlOiB0cnVlIH0pKTtcbn07XG5cbnZhciBub3JtYWxpemVLZXl3b3JkcyA9IGZ1bmN0aW9uIChrZXl3b3JkKSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoa2V5d29yZCkgPyBrZXl3b3JkLm1hcChmdW5jdGlvbiAoaykgeyByZXR1cm4gbm9ybWFsaXplU2luZ2xlS2V5d29yZChrKTsgfSkgOiBbbm9ybWFsaXplU2luZ2xlS2V5d29yZChrZXl3b3JkKV07XG59O1xudmFyIHNlYXJjaFBsdWdpbiA9IGZ1bmN0aW9uIChwcm9wcykge1xuICAgIHZhciBzZWFyY2hQbHVnaW5Qcm9wcyA9IFJlYWN0X19uYW1lc3BhY2UudXNlTWVtbyhmdW5jdGlvbiAoKSB7IHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB7IGVuYWJsZVNob3J0Y3V0czogdHJ1ZSwgb25IaWdobGlnaHRLZXl3b3JkOiBmdW5jdGlvbiAoKSB7IH0gfSwgcHJvcHMpOyB9LCBbXSk7XG4gICAgdmFyIHN0b3JlID0gUmVhY3RfX25hbWVzcGFjZS51c2VNZW1vKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNvcmUuY3JlYXRlU3RvcmUoe1xuICAgICAgICAgICAgaW5pdGlhbEtleXdvcmQ6IHByb3BzICYmIHByb3BzLmtleXdvcmQgPyAoQXJyYXkuaXNBcnJheShwcm9wcy5rZXl3b3JkKSA/IHByb3BzLmtleXdvcmQgOiBbcHJvcHMua2V5d29yZF0pIDogW10sXG4gICAgICAgICAgICBrZXl3b3JkOiBwcm9wcyAmJiBwcm9wcy5rZXl3b3JkID8gbm9ybWFsaXplS2V5d29yZHMocHJvcHMua2V5d29yZCkgOiBbRU1QVFlfS0VZV09SRF9SRUdFWFBdLFxuICAgICAgICAgICAgbWF0Y2hQb3NpdGlvbjoge1xuICAgICAgICAgICAgICAgIG1hdGNoSW5kZXg6IC0xLFxuICAgICAgICAgICAgICAgIHBhZ2VJbmRleDogLTEsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVuZGVyU3RhdHVzOiBuZXcgTWFwKCksXG4gICAgICAgIH0pO1xuICAgIH0sIFtdKTtcbiAgICB2YXIgX2EgPSB1c2VTZWFyY2goc3RvcmUpLCBjbGVhcktleXdvcmQgPSBfYS5jbGVhcktleXdvcmQsIGp1bXBUb01hdGNoID0gX2EuanVtcFRvTWF0Y2gsIGp1bXBUb05leHRNYXRjaCA9IF9hLmp1bXBUb05leHRNYXRjaCwganVtcFRvUHJldmlvdXNNYXRjaCA9IF9hLmp1bXBUb1ByZXZpb3VzTWF0Y2gsIHNlYXJjaEZvciA9IF9hLnNlYXJjaEZvciwgc2V0S2V5d29yZHMgPSBfYS5zZXRLZXl3b3Jkcywgc2V0VGFyZ2V0UGFnZXMgPSBfYS5zZXRUYXJnZXRQYWdlcztcbiAgICB2YXIgU2VhcmNoRGVjb3JhdG9yID0gZnVuY3Rpb24gKHByb3BzKSB7IHJldHVybiBSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoU2VhcmNoLCBfX2Fzc2lnbih7fSwgcHJvcHMsIHsgc3RvcmU6IHN0b3JlIH0pKTsgfTtcbiAgICB2YXIgU2hvd1NlYXJjaFBvcG92ZXJEZWNvcmF0b3IgPSBmdW5jdGlvbiAocHJvcHMpIHsgcmV0dXJuIChSZWFjdF9fbmFtZXNwYWNlLmNyZWF0ZUVsZW1lbnQoU2hvd1NlYXJjaFBvcG92ZXIsIF9fYXNzaWduKHsgZW5hYmxlU2hvcnRjdXRzOiBzZWFyY2hQbHVnaW5Qcm9wcy5lbmFibGVTaG9ydGN1dHMgfSwgcHJvcHMsIHsgc3RvcmU6IHN0b3JlIH0pKSk7IH07XG4gICAgdmFyIFNob3dTZWFyY2hQb3BvdmVyQnV0dG9uRGVjb3JhdG9yID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChTaG93U2VhcmNoUG9wb3ZlckRlY29yYXRvciwgbnVsbCwgZnVuY3Rpb24gKHByb3BzKSB7IHJldHVybiAoUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFNob3dTZWFyY2hQb3BvdmVyQnV0dG9uLCBfX2Fzc2lnbih7IGVuYWJsZVNob3J0Y3V0czogc2VhcmNoUGx1Z2luUHJvcHMuZW5hYmxlU2hvcnRjdXRzLCBzdG9yZTogc3RvcmUgfSwgcHJvcHMpKSk7IH0pKTsgfTtcbiAgICB2YXIgcmVuZGVyVmlld2VyID0gZnVuY3Rpb24gKHJlbmRlclZpZXdlclByb3BzKSB7XG4gICAgICAgIHZhciBjdXJyZW50U2xvdCA9IHJlbmRlclZpZXdlclByb3BzLnNsb3Q7XG4gICAgICAgIGlmIChjdXJyZW50U2xvdC5zdWJTbG90KSB7XG4gICAgICAgICAgICBjdXJyZW50U2xvdC5zdWJTbG90LmNoaWxkcmVuID0gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChSZWFjdF9fbmFtZXNwYWNlLkZyYWdtZW50LCBudWxsLFxuICAgICAgICAgICAgICAgIHNlYXJjaFBsdWdpblByb3BzLmVuYWJsZVNob3J0Y3V0cyAmJiAoUmVhY3RfX25hbWVzcGFjZS5jcmVhdGVFbGVtZW50KFNob3J0Y3V0SGFuZGxlciwgeyBjb250YWluZXJSZWY6IHJlbmRlclZpZXdlclByb3BzLmNvbnRhaW5lclJlZiwgc3RvcmU6IHN0b3JlIH0pKSxcbiAgICAgICAgICAgICAgICBjdXJyZW50U2xvdC5zdWJTbG90LmNoaWxkcmVuKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRTbG90O1xuICAgIH07XG4gICAgdmFyIHJlbmRlclBhZ2VMYXllciA9IGZ1bmN0aW9uIChyZW5kZXJQcm9wcykgeyByZXR1cm4gKFJlYWN0X19uYW1lc3BhY2UuY3JlYXRlRWxlbWVudChIaWdobGlnaHRzLCB7IGtleTogcmVuZGVyUHJvcHMucGFnZUluZGV4LCBudW1QYWdlczogcmVuZGVyUHJvcHMuZG9jLm51bVBhZ2VzLCBwYWdlSW5kZXg6IHJlbmRlclByb3BzLnBhZ2VJbmRleCwgcmVuZGVySGlnaGxpZ2h0czogcHJvcHMgPT09IG51bGwgfHwgcHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb3BzLnJlbmRlckhpZ2hsaWdodHMsIHN0b3JlOiBzdG9yZSwgb25IaWdobGlnaHRLZXl3b3JkOiBzZWFyY2hQbHVnaW5Qcm9wcy5vbkhpZ2hsaWdodEtleXdvcmQgfSkpOyB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIGluc3RhbGw6IGZ1bmN0aW9uIChwbHVnaW5GdW5jdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBpbml0aWFsS2V5d29yZCA9IHByb3BzICYmIHByb3BzLmtleXdvcmQgPyAoQXJyYXkuaXNBcnJheShwcm9wcy5rZXl3b3JkKSA/IHByb3BzLmtleXdvcmQgOiBbcHJvcHMua2V5d29yZF0pIDogW107XG4gICAgICAgICAgICB2YXIga2V5d29yZCA9IHByb3BzICYmIHByb3BzLmtleXdvcmQgPyBub3JtYWxpemVLZXl3b3Jkcyhwcm9wcy5rZXl3b3JkKSA6IFtFTVBUWV9LRVlXT1JEX1JFR0VYUF07XG4gICAgICAgICAgICBzdG9yZS51cGRhdGUoJ2luaXRpYWxLZXl3b3JkJywgaW5pdGlhbEtleXdvcmQpO1xuICAgICAgICAgICAgc3RvcmUudXBkYXRlKCdqdW1wVG9EZXN0aW5hdGlvbicsIHBsdWdpbkZ1bmN0aW9ucy5qdW1wVG9EZXN0aW5hdGlvbik7XG4gICAgICAgICAgICBzdG9yZS51cGRhdGUoJ2p1bXBUb1BhZ2UnLCBwbHVnaW5GdW5jdGlvbnMuanVtcFRvUGFnZSk7XG4gICAgICAgICAgICBzdG9yZS51cGRhdGUoJ2tleXdvcmQnLCBrZXl3b3JkKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyUGFnZUxheWVyOiByZW5kZXJQYWdlTGF5ZXIsXG4gICAgICAgIHJlbmRlclZpZXdlcjogcmVuZGVyVmlld2VyLFxuICAgICAgICB1bmluc3RhbGw6IGZ1bmN0aW9uIChwcm9wcykge1xuICAgICAgICAgICAgdmFyIHJlbmRlclN0YXR1cyA9IHN0b3JlLmdldCgncmVuZGVyU3RhdHVzJyk7XG4gICAgICAgICAgICBpZiAocmVuZGVyU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyU3RhdHVzLmNsZWFyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9uRG9jdW1lbnRMb2FkOiBmdW5jdGlvbiAocHJvcHMpIHtcbiAgICAgICAgICAgIHN0b3JlLnVwZGF0ZSgnZG9jJywgcHJvcHMuZG9jKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25UZXh0TGF5ZXJSZW5kZXI6IGZ1bmN0aW9uIChwcm9wcykge1xuICAgICAgICAgICAgdmFyIHJlbmRlclN0YXR1cyA9IHN0b3JlLmdldCgncmVuZGVyU3RhdHVzJyk7XG4gICAgICAgICAgICBpZiAocmVuZGVyU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmVuZGVyU3RhdHVzID0gcmVuZGVyU3RhdHVzLnNldChwcm9wcy5wYWdlSW5kZXgsIHByb3BzKTtcbiAgICAgICAgICAgICAgICBzdG9yZS51cGRhdGUoJ3JlbmRlclN0YXR1cycsIHJlbmRlclN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFNlYXJjaDogU2VhcmNoRGVjb3JhdG9yLFxuICAgICAgICBTaG93U2VhcmNoUG9wb3ZlcjogU2hvd1NlYXJjaFBvcG92ZXJEZWNvcmF0b3IsXG4gICAgICAgIFNob3dTZWFyY2hQb3BvdmVyQnV0dG9uOiBTaG93U2VhcmNoUG9wb3ZlckJ1dHRvbkRlY29yYXRvcixcbiAgICAgICAgY2xlYXJIaWdobGlnaHRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjbGVhcktleXdvcmQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgaGlnaGxpZ2h0OiBmdW5jdGlvbiAoa2V5d29yZCkge1xuICAgICAgICAgICAgdmFyIGtleXdvcmRzID0gQXJyYXkuaXNBcnJheShrZXl3b3JkKSA/IGtleXdvcmQgOiBba2V5d29yZF07XG4gICAgICAgICAgICBzZXRLZXl3b3JkcyhrZXl3b3Jkcyk7XG4gICAgICAgICAgICByZXR1cm4gc2VhcmNoRm9yKGtleXdvcmRzKTtcbiAgICAgICAgfSxcbiAgICAgICAganVtcFRvTWF0Y2g6IGp1bXBUb01hdGNoLFxuICAgICAgICBqdW1wVG9OZXh0TWF0Y2g6IGp1bXBUb05leHRNYXRjaCxcbiAgICAgICAganVtcFRvUHJldmlvdXNNYXRjaDoganVtcFRvUHJldmlvdXNNYXRjaCxcbiAgICAgICAgc2V0VGFyZ2V0UGFnZXM6IHNldFRhcmdldFBhZ2VzLFxuICAgIH07XG59O1xuXG5leHBvcnRzLk5leHRJY29uID0gTmV4dEljb247XG5leHBvcnRzLlByZXZpb3VzSWNvbiA9IFByZXZpb3VzSWNvbjtcbmV4cG9ydHMuU2VhcmNoSWNvbiA9IFNlYXJjaEljb247XG5leHBvcnRzLnNlYXJjaFBsdWdpbiA9IHNlYXJjaFBsdWdpbjtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/cjs/search.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/index.js":
/*!******************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/index.js ***!
  \******************************************************************************************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("/**\n * A React component to view a PDF document\n *\n * @see https://react-pdf-viewer.dev\n * @license https://react-pdf-viewer.dev/license\n * @copyright 2019-2023 Nguyen Huu Phuoc <me@phuoc.ng>\n */\n\n\n\nif (false) {} else {\n    module.exports = __webpack_require__(/*! ./cjs/search.js */ \"(ssr)/./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/cjs/search.js\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQHJlYWN0LXBkZi12aWV3ZXIrc2VhcmNoQDMuMTIuMF9wZGZqcy1kaXN0QDMuNC4xMjBfcmVhY3QtZG9tQDE5LjAuMF9yZWFjdEAxOS4wLjBfX3JlYWN0QDE5LjAuMC9ub2RlX21vZHVsZXMvQHJlYWN0LXBkZi12aWV3ZXIvc2VhcmNoL2xpYi9pbmRleC5qcyIsIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFYTs7QUFFYixJQUFJLEtBQXFDLEVBQUUsRUFFMUMsQ0FBQztBQUNGLElBQUksZ1BBQTJDO0FBQy9DIiwic291cmNlcyI6WyIvaG9tZS9ub2UtY2FtcG8vZGVsb3MvcHJvamV0L2xhYi1rcy9rcy1sYWIvbm9kZV9tb2R1bGVzLy5wbnBtL0ByZWFjdC1wZGYtdmlld2VyK3NlYXJjaEAzLjEyLjBfcGRmanMtZGlzdEAzLjQuMTIwX3JlYWN0LWRvbUAxOS4wLjBfcmVhY3RAMTkuMC4wX19yZWFjdEAxOS4wLjAvbm9kZV9tb2R1bGVzL0ByZWFjdC1wZGYtdmlld2VyL3NlYXJjaC9saWIvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBIFJlYWN0IGNvbXBvbmVudCB0byB2aWV3IGEgUERGIGRvY3VtZW50XG4gKlxuICogQHNlZSBodHRwczovL3JlYWN0LXBkZi12aWV3ZXIuZGV2XG4gKiBAbGljZW5zZSBodHRwczovL3JlYWN0LXBkZi12aWV3ZXIuZGV2L2xpY2Vuc2VcbiAqIEBjb3B5cmlnaHQgMjAxOS0yMDIzIE5ndXllbiBIdXUgUGh1b2MgPG1lQHBodW9jLm5nPlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vY2pzL3NlYXJjaC5taW4uanMnKTtcbn0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL2Nqcy9zZWFyY2guanMnKTtcbn1cbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@react-pdf-viewer+search@3.12.0_pdfjs-dist@3.4.120_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@react-pdf-viewer/search/lib/index.js\n");

/***/ })

};
;